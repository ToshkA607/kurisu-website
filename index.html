<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Макисэ Курису - Гений-нейробиолог | Лаборатория Будущего</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { 
        getAuth, 
        createUserWithEmailAndPassword, 
        signInWithEmailAndPassword, 
        signOut, 
        onAuthStateChanged,
        updateProfile
    } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
    
    import { 
        getFirestore,
        collection,
        addDoc,
        getDocs,
        query,
        where,
        orderBy,
        deleteDoc,
        doc,
        updateDoc,
        serverTimestamp,
        getDoc,
        setDoc // ← ДОБАВЬ ЭТУ СТРОЧКУ!
    } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // Конфигурация Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDBCjzCv1mAAjhV9_ljTXZ7Fn8Ix1_vU-k",
            authDomain: "kurisu-lab.firebaseapp.com",
            projectId: "kurisu-lab",
            storageBucket: "kurisu-lab.firebasestorage.app",
            messagingSenderId: "754858147142",
            appId: "1:754858147142:web:1f03a6f17c442132297947"
        };

        // Инициализация Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Делаем переменные глобально доступными
        window.firebase = {
            app,
            auth,
            db,
            authFunctions: {
                createUserWithEmailAndPassword,
                signInWithEmailAndPassword,
                signOut,
                onAuthStateChanged,
                updateProfile
            },
            firestoreFunctions: {
                getFirestore,
                collection,
                addDoc,
                getDocs,
                query,
                where,
                orderBy,
                deleteDoc,
                doc,
                updateDoc,
                serverTimestamp,
                getDoc
            }
        };
        
        console.log("Firebase инициализирован!");
    </script>
    
    <style>
        /* Глобальные стили и переменные */
        :root {
            --primary: #c62828;
            --primary-dark: #8e0000;
            --primary-light: #ff5f52;
            --secondary: #1a237e;
            --secondary-dark: #000051;
            --secondary-light: #534bae;
            --accent: #f44336;
            --text: #f5f5f5;
            --text-secondary: #bdbdbd;
            --bg-dark: #0a0a12;
            --bg-card: #151522;
            --lab-green: #00e676;
            --lab-blue: #2979ff;
            --timeline-blue: #00e5ff;
            --timeline-glow: #00b8d4;
            --profile-purple: #9c27b0;
            --comment-bg: #1a1a2e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Noto Sans', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        html {
            scroll-behavior: smooth;
            -webkit-text-size-adjust: 100%;
        }
        
        body {
            background-color: var(--bg-dark);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(198, 40, 40, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(26, 35, 126, 0.05) 0%, transparent 20%);
        }
        
        /* =========================================== */
        /* СТИЛИ КОММЕНТАРИЕВ */
        /* =========================================== */
        
        .comments-section {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 30px;
            margin-top: 40px;
            border: 2px solid rgba(41, 121, 255, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .comments-title {
            font-size: 1.8rem;
            color: var(--lab-blue);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: 0 0 10px rgba(41, 121, 255, 0.3);
        }
        
        .comments-title i {
            color: var(--lab-blue);
            font-size: 1.5rem;
        }
        
        .comment-form {
            background: var(--comment-bg);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            border: 1px solid rgba(41, 121, 255, 0.2);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .comment-form-title {
            font-size: 1.2rem;
            color: var(--lab-blue);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .comment-input-container {
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }
        
        .comment-input-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .comment-textarea {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text);
            font-size: 1rem;
            resize: vertical;
            transition: all 0.3s;
            font-family: inherit;
        }
        
        .comment-textarea:focus {
            outline: none;
            border-color: var(--lab-blue);
            box-shadow: 0 0 0 3px rgba(41, 121, 255, 0.2);
            background: rgba(255, 255, 255, 0.07);
        }
        
        .comment-textarea::placeholder {
            color: var(--text-secondary);
        }
        
        .comment-form-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .comment-char-count {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .comment-char-count.warning {
            color: #ff9800;
        }
        
        .comment-char-count.error {
            color: #f44336;
        }
        
        .comment-submit-btn {
            padding: 10px 25px;
            background: linear-gradient(135deg, var(--lab-blue), var(--secondary-dark));
            color: white;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
        }
        
        .comment-submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(41, 121, 255, 0.3);
        }
        
        .comment-submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .login-to-comment {
            text-align: center;
            padding: 20px;
            background: rgba(41, 121, 255, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(41, 121, 255, 0.3);
            margin-bottom: 20px;
        }
        
        .login-to-comment p {
            color: var(--text-secondary);
            margin-bottom: 15px;
        }
        
        /* Комментарии */
        .comments-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .comment-item {
            background: var(--comment-bg);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--lab-blue);
            transition: all 0.3s;
            animation: fadeIn 0.5s ease-out;
            position: relative;
            overflow: hidden;
        }
        
        .comment-item:hover {
            transform: translateX(5px);
            background: rgba(41, 121, 255, 0.05);
        }
        
        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .comment-author {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .comment-author-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--lab-blue), var(--profile-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 1rem;
            background-size: cover;
            background-position: center;
        }
        
        .comment-author-info {
            display: flex;
            flex-direction: column;
            gap: 3px;
        }
        
        .comment-author-name {
            font-weight: 600;
            color: var(--lab-blue);
        }
        
        .comment-author-role {
            font-size: 0.8rem;
            color: var(--text-secondary);
            background: rgba(41, 121, 255, 0.1);
            padding: 2px 8px;
            border-radius: 10px;
            display: inline-block;
        }
        
        .comment-date {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .comment-content {
            margin-top: 10px;
            line-height: 1.7;
            color: var(--text);
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .comment-episode-info {
            margin-top: 10px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .comment-episode-info i {
            color: var(--primary);
        }
        
        /* Кнопка удаления комментария */
        .comment-delete-btn {
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid rgba(244, 67, 54, 0.3);
            color: #f44336;
            padding: 6px 12px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.8rem;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            opacity: 0.8;
            margin-left: auto;
        }
        
        .comment-item:hover .comment-delete-btn {
            opacity: 1;
        }
        
        .comment-delete-btn:hover {
            background: rgba(244, 67, 54, 0.2);
            opacity: 1;
            transform: translateY(-2px);
        }

        .no-comments {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
            font-style: italic;
        }
        
        .no-comments i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: var(--lab-blue);
            opacity: 0.5;
        }
        
        .loading-comments {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
        }
        
        .loading-comments i {
            font-size: 2rem;
            margin-bottom: 15px;
            color: var(--lab-blue);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Модальное окно комментариев */
        .comments-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            z-index: 10002;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .comments-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .comments-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            width: 95%;
            max-width: 800px;
            height: 90vh;
            background: linear-gradient(135deg, rgba(21, 21, 34, 0.98), rgba(10, 10, 18, 0.99));
            border-radius: 20px;
            border: 2px solid rgba(41, 121, 255, 0.4);
            box-shadow: 
                0 30px 80px rgba(0, 0, 0, 0.8),
                0 0 80px rgba(41, 121, 255, 0.4),
                inset 0 0 50px rgba(255, 255, 255, 0.1);
            z-index: 10003;
            opacity: 0;
            visibility: hidden;
            overflow: hidden;
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
        }
        
        .comments-modal.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }
        
        .comments-modal-header {
            padding: 20px 30px;
            background: linear-gradient(90deg, rgba(41, 121, 255, 0.2), transparent);
            border-bottom: 1px solid rgba(41, 121, 255, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }
        
        .comments-modal-title {
            font-size: 1.5rem;
            color: var(--lab-blue);
            text-shadow: 0 0 15px rgba(41, 121, 255, 0.5);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .comments-close-modal {
            background: rgba(41, 121, 255, 0.2);
            border: 2px solid rgba(41, 121, 255, 0.4);
            color: var(--text);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .comments-close-modal:hover {
            background: rgba(41, 121, 255, 0.4);
            transform: rotate(90deg);
            box-shadow: 0 0 15px rgba(41, 121, 255, 0.5);
        }
        
        .comments-modal-body {
            padding: 25px;
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        /* Кнопка открытия комментариев */
        .open-comments-btn {
            margin-top: 20px;
            padding: 12px 25px;
            background: linear-gradient(135deg, var(--lab-blue), var(--secondary-dark));
            color: white;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
        }
        
        .open-comments-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(41, 121, 255, 0.3);
        }
        
        .open-comments-btn i {
            font-size: 1.1rem;
        }
        
        /* Анимация появления комментариев */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .comment-item {
            animation: slideInUp 0.4s ease-out;
        }
        
        /* Адаптивность комментариев */
        @media (max-width: 768px) {
            .comments-section {
                padding: 20px;
                margin-top: 30px;
            }
            
            .comments-title {
                font-size: 1.5rem;
            }
            
            .comment-form {
                padding: 20px;
            }
            
            .comment-input-container {
                flex-direction: column;
                align-items: center;
            }
            
            .comment-form-actions {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }
            
            .comment-submit-btn {
                width: 100%;
                justify-content: center;
            }
            
            .comment-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .comments-modal {
                width: 98%;
                height: 95vh;
                border-radius: 15px;
            }
            
            .comments-modal-header {
                padding: 15px 20px;
            }
            
            .comments-modal-title {
                font-size: 1.3rem;
            }
            
            .comments-modal-body {
                padding: 20px;
            }
            
            .open-comments-btn {
                width: 100%;
                justify-content: center;
            }
            
            .comment-delete-btn {
                opacity: 1;
            }
        }
        
        @media (max-width: 480px) {
            .comments-section {
                padding: 15px;
            }
            
            .comment-form {
                padding: 15px;
            }
            
            .comment-textarea {
                min-height: 80px;
                padding: 12px;
                font-size: 0.95rem;
            }
            
            .comment-item {
                padding: 15px;
            }
            
            .comment-author {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .comment-author-avatar {
                width: 35px;
                height: 35px;
                font-size: 0.9rem;
            }
            
            .comment-episode-info {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .comment-delete-btn {
                margin-left: 0;
                margin-top: 5px;
                align-self: flex-end;
            }
        }
        
        /* Стили для скроллбара комментариев */
        .comments-modal-body::-webkit-scrollbar,
        .comments-list::-webkit-scrollbar {
            width: 8px;
        }
        
        .comments-modal-body::-webkit-scrollbar-track {
            background: rgba(41, 121, 255, 0.1);
            border-radius: 4px;
        }
        
        .comments-modal-body::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, var(--lab-blue), var(--secondary-light));
            border-radius: 4px;
        }
        
        .comments-modal-body::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, var(--secondary-light), var(--lab-blue));
        }

        /* Остальные стили из вашего файла остаются без изменений */
        /* Стили для эффекта фейерверка */
        .firework {
            position: fixed;
            pointer-events: none;
            z-index: 9999;
            border-radius: 50%;
        }
        
        .particle {
            position: fixed;
            pointer-events: none;
            border-radius: 50%;
            z-index: 9998;
        }
        
        /* Анимации */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        @keyframes textShine {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }
        
        @keyframes slideInLeft {
            from { transform: translateX(-100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes nodePulse {
            0%, 100% {
                transform: translateY(-50%) scale(1);
                box-shadow: 
                    0 0 0 0 rgba(0, 229, 255, 0.7),
                    0 0 15px var(--timeline-blue);
            }
            50% {
                transform: translateY(-50%) scale(1.2);
                box-shadow: 
                    0 0 0 8px rgba(0, 229, 255, 0),
                    0 0 25px var(--timeline-blue);
            }
        }
        
        @keyframes glow {
            0%, 100% {
                filter: drop-shadow(0 0 5px var(--timeline-blue));
            }
            50% {
                filter: drop-shadow(0 0 15px var(--timeline-blue)) drop-shadow(0 0 25px var(--timeline-glow));
            }
        }
        
        @keyframes pulseFlow {
            0% {
                top: -100px;
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                top: 100%;
                opacity: 0;
            }
        }

        @keyframes contentSlideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes iconPulse {
            0%, 100% {
                transform: scale(1) rotate(0deg);
            }
            50% {
                transform: scale(1.1) rotate(180deg);
            }
        }

        @keyframes scanLine {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }

        @keyframes dataStream {
            0% {
                transform: translateY(0);
            }
            100% {
                transform: translateY(-100%);
            }
        }
        
        /* Анимации для вкладок достижений */
        @keyframes tabSlideDown {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes contentExpand {
            from {
                max-height: 0;
                opacity: 0;
                transform: scaleY(0.9);
            }
            to {
                max-height: 800px;
                opacity: 1;
                transform: scaleY(1);
            }
        }
        
        @keyframes bloodPulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(198, 40, 40, 0.4);
            }
            70% {
                box-shadow: 0 0 0 15px rgba(198, 40, 40, 0);
            }
        }

        /* =========================================== */
        /* СТИЛИ СИСТЕМЫ АВТОРИЗАЦИИ */
        /* =========================================== */
        
        /* Навигация с авторизацией */
        .nav-auth-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            width: 100%;
            position: relative;
        }
        
        /* Кнопки авторизации */
        .auth-buttons {
            display: flex;
            gap: 10px;
            align-items: center;
            z-index: 1001;
        }
        
        .auth-btn {
            padding: 5px 20px;
            border-radius: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            border: 2px solid transparent;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 80px;
        }
        
        .login-btn {
            background: transparent;
            color: var(--text);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .login-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .register-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
        }
        
        .register-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(198, 40, 40, 0.4);
        }
        
        /* Информация о пользователе */
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1001;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--profile-purple));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            background-size: cover;
            background-position: center;
        }
        
        .user-avatar:hover {
            transform: scale(1.1);
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(198, 40, 40, 0.5);
        }
        
        .user-name {
            font-weight: 600;
            color: var(--text);
            font-size: 0.9rem;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .profile-btn {
            padding: 6px 16px;
            background: rgba(41, 121, 255, 0.1);
            color: var(--lab-blue);
            border: 1px solid rgba(41, 121, 255, 0.3);
            border-radius: 18px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
            height: 34px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .profile-btn:hover {
            background: rgba(41, 121, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(41, 121, 255, 0.3);
        }
        
        /* Модальные окна авторизации */
        .auth-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            z-index: 9998;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .auth-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .auth-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            width: 90%;
            max-width: 450px;
            background: linear-gradient(135deg, rgba(21, 21, 34, 0.98), rgba(10, 10, 18, 0.99));
            border-radius: 15px;
            border: 2px solid rgba(198, 40, 40, 0.4);
            box-shadow: 
                0 20px 50px rgba(0, 0, 0, 0.8),
                0 0 50px rgba(198, 40, 40, 0.3),
                inset 0 0 30px rgba(255, 255, 255, 0.05);
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            overflow: hidden;
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .auth-modal.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }
        
        .auth-modal-header {
            padding: 25px 30px;
            background: linear-gradient(90deg, rgba(198, 40, 40, 0.2), transparent);
            border-bottom: 1px solid rgba(198, 40, 40, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .auth-modal-title {
            font-size: 1.8rem;
            color: var(--primary);
            text-shadow: 0 0 15px rgba(198, 40, 40, 0.5);
            margin: 0;
        }
        
        .auth-close-modal {
            background: rgba(198, 40, 40, 0.2);
            border: 2px solid rgba(198, 40, 40, 0.4);
            color: var(--text);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .auth-close-modal:hover {
            background: rgba(198, 40, 40, 0.4);
            transform: rotate(90deg);
            box-shadow: 0 0 15px rgba(198, 40, 40, 0.5);
        }
        
        .auth-modal-body {
            padding: 30px;
        }
        
        /* Табы форм */
        .auth-tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .auth-tab-btn {
            flex: 1;
            padding: 15px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .auth-tab-btn.active {
            color: var(--primary);
        }
        
        .auth-tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
        }
        
        /* Формы */
        .auth-form {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .auth-form-group {
            margin-bottom: 20px;
        }
        
        .auth-form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text);
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .auth-form-control {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .auth-form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(198, 40, 40, 0.2);
        }
        
        .auth-form-control::placeholder {
            color: var(--text-secondary);
        }
        
        .auth-password-field {
            position: relative;
        }
        
        .auth-toggle-password {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1rem;
        }
        
        .auth-form-check {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .auth-form-check input {
            width: 16px;
            height: 16px;
        }
        
        .auth-form-check label {
            color: var(--text-secondary);
            font-size: 0.85rem;
            cursor: pointer;
        }
        
        /* Кнопки форм */
        .auth-form-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .auth-form-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(198, 40, 40, 0.3);
        }
        
        .auth-form-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        
        .auth-form-btn:hover::after {
            left: 100%;
        }
        
        /* Сообщения */
        .auth-message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            animation: fadeIn 0.3s ease-out;
            font-size: 0.9rem;
        }
        
        .auth-message.success {
            background: rgba(0, 230, 118, 0.1);
            border: 1px solid rgba(0, 230, 118, 0.3);
            color: #00e676;
        }
        
        .auth-message.error {
            background: rgba(255, 82, 82, 0.1);
            border: 1px solid rgba(255, 82, 82, 0.3);
            color: #ff5252;
        }
        
        .auth-message.show {
            display: block;
        }
        
        /* =========================================== */
        /* СТИЛИ ПРОФИЛЯ ПОЛЬЗОВАТЕЛЯ */
        /* =========================================== */
        
        .profile-page {
            display: none;
            min-height: 100vh;
            padding: 100px 20px 60px;
            animation: fadeIn 0.5s ease-out;
            background: linear-gradient(135deg, rgba(10, 10, 18, 0.95), rgba(21, 21, 34, 0.98));
        }
        
        .profile-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .profile-header {
            text-align: center;
            margin-bottom: 50px;
            position: relative;
        }
        
        .profile-main-title {
            font-size: 2.8rem;
            color: var(--primary);
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(198, 40, 40, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .profile-status {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .status-time {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            padding: 8px 20px;
            border-radius: 30px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .profile-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 50px;
        }
        
        @media (max-width: 992px) {
            .profile-content {
                grid-template-columns: 1fr;
            }
        }
        
        .profile-sidebar {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid rgba(198, 40, 40, 0.3);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        }
        
        .profile-avatar-section {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .profile-avatar-large {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--profile-purple), var(--lab-blue));
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            color: white;
            font-weight: bold;
            border: 5px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 0 30px rgba(198, 40, 40, 0.4),
                0 0 60px rgba(156, 39, 176, 0.3);
            position: relative;
            overflow: hidden;
            cursor: pointer;
            background-size: cover;
            background-position: center;
        }
        
        .profile-avatar-large:hover::before {
            content: 'Изменить аватар';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: white;
            z-index: 2;
        }
        
        .profile-avatar-large::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(255, 255, 255, 0.1),
                transparent
            );
            transform: rotate(45deg);
            animation: scanLine 3s linear infinite;
            z-index: 1;
        }
        
        .avatar-upload-btn {
            margin-top: 15px;
            padding: 8px 20px;
            background: rgba(41, 121, 255, 0.2);
            color: var(--lab-blue);
            border: 1px solid rgba(41, 121, 255, 0.4);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .avatar-upload-btn:hover {
            background: rgba(41, 121, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .profile-user-name {
            font-size: 1.8rem;
            color: var(--text);
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .profile-user-role {
            color: var(--primary);
            font-size: 1.1rem;
            font-weight: 500;
            background: rgba(198, 40, 40, 0.1);
            padding: 6px 15px;
            border-radius: 20px;
            display: inline-block;
            border: 1px solid rgba(198, 40, 40, 0.3);
        }
        
        .profile-stats {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 30px;
        }
        
        .profile-stat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .profile-stat-item:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
            border-color: var(--primary-light);
            box-shadow: 0 10px 20px rgba(198, 40, 40, 0.2);
        }
        
        .profile-stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--lab-blue);
            margin-bottom: 5px;
            text-shadow: 0 0 10px rgba(41, 121, 255, 0.5);
        }
        
        .profile-stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .profile-main {
            background: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid rgba(41, 121, 255, 0.3);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
        }
        
        .profile-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 15px;
        }
        
        .profile-tab-btn {
            padding: 12px 25px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 10px;
            position: relative;
        }
        
        .profile-tab-btn.active {
            color: var(--lab-blue);
            background: rgba(41, 121, 255, 0.1);
        }
        
        .profile-tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -17px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--lab-blue), var(--secondary-light));
        }
        
        .profile-tab-content {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }
        
        .profile-tab-content.active {
            display: block;
        }
        
        .profile-info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .profile-info-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .profile-info-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .profile-info-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .profile-info-value {
            color: var(--text);
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .profile-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 50px;
            padding-top: 30px;
            border-top: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .back-btn {
            padding: 14px 35px;
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
        }
        
        .back-btn:hover {
            background: rgba(198, 40, 40, 0.1);
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(198, 40, 40, 0.3);
        }
        
        .logout-btn {
            padding: 14px 35px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
        }
        
        .logout-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(198, 40, 40, 0.3);
        }
        
        .logout-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        
        .logout-btn:hover::after {
            left: 100%;
        }
        
        .edit-profile-btn {
            padding: 14px 35px;
            background: linear-gradient(135deg, var(--lab-blue), var(--secondary-dark));
            color: white;
            border: none;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
        }
        
        .edit-profile-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(41, 121, 255, 0.3);
        }
        
        /* Модальное окно редактирования профиля */
        .edit-profile-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            width: 90%;
            max-width: 500px;
            background: linear-gradient(135deg, rgba(21, 21, 34, 0.98), rgba(10, 10, 18, 0.99));
            border-radius: 20px;
            border: 2px solid rgba(41, 121, 255, 0.4);
            box-shadow: 
                0 30px 80px rgba(0, 0, 0, 0.8),
                0 0 80px rgba(41, 121, 255, 0.4),
                inset 0 0 50px rgba(255, 255, 255, 0.1);
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            overflow: hidden;
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .edit-profile-modal.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }
        
        .edit-profile-modal-header {
            padding: 25px 30px;
            background: linear-gradient(90deg, rgba(41, 121, 255, 0.2), transparent);
            border-bottom: 1px solid rgba(41, 121, 255, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .edit-profile-modal-title {
            font-size: 1.8rem;
            color: var(--lab-blue);
            text-shadow: 0 0 20px rgba(41, 121, 255, 0.5);
            margin: 0;
        }
        
        .edit-profile-close-modal {
            background: rgba(41, 121, 255, 0.2);
            border: 2px solid rgba(41, 121, 255, 0.4);
            color: var(--text);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .edit-profile-close-modal:hover {
            background: rgba(41, 121, 255, 0.4);
            transform: rotate(90deg);
            box-shadow: 0 0 20px rgba(41, 121, 255, 0.5);
        }
        
        .edit-profile-modal-body {
            padding: 30px;
            max-height: 70vh;
            overflow-y: auto;
        }
        
        .edit-profile-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .edit-profile-form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .edit-profile-form-label {
            color: var(--text);
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        .edit-profile-form-control {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--text);
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .edit-profile-form-control:focus {
            outline: none;
            border-color: var(--lab-blue);
            box-shadow: 0 0 0 3px rgba(41, 121, 255, 0.2);
        }
        
        .edit-profile-form-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--lab-blue), var(--secondary-dark));
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .edit-profile-form-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(41, 121, 255, 0.3);
        }
        
        /* Скрытый input для загрузки аватара */
        .avatar-input {
            display: none;
        }
        
        /* Элементы интерфейса */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            width: 100%;
        }
        
        section {
            padding: 60px 0;
            position: relative;
        }
        
        .section-title {
            font-size: 2.5rem;
            margin-bottom: 3rem;
            position: relative;
            display: inline-block;
            text-align: center;
            width: 100%;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--lab-blue));
            border-radius: 2px;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 30px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 30px;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(198, 40, 40, 0.3);
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: 0.5s;
        }
        
        .btn:hover::after {
            left: 100%;
        }
        
        /* Навигация */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background: rgba(10, 10, 18, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px 0;
            min-height: 70px;
        }
        
        /* Навигационные ссылки */
        .nav-links {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
            flex-wrap: nowrap;
            justify-content: center;
            width: 100%;
        }
        
        .nav-links li {
            margin: 0 10px;
        }
        
        .nav-links a {
            color: var(--text);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            position: relative;
            font-size: 1rem;
            white-space: nowrap;
            padding: 5px 0;
        }
        
        .nav-links a:hover {
            color: var(--primary);
        }
        
        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary);
            transition: width 0.3s;
        }
        
        .nav-links a:hover::after {
            width: 100%;
        }
        
        /* Герой секция */
        .hero {
            height: 100vh;
            display: flex;
            align-items: center;
            position: relative;
            overflow: hidden;
            padding-top: 80px;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(198, 40, 40, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(41, 121, 255, 0.1) 0%, transparent 50%);
            z-index: -1;
        }
        
        .hero-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        .hero-content {
            max-width: 600px;
            animation: slideInLeft 1s ease-out;
            z-index: 2;
        }
        
        .hero-title {
            font-size: 3.5rem;
            margin-bottom: 20px;
            line-height: 1.2;
        }
        
        .hero-title .glitch {
            position: relative;
            display: inline-block;
        }
        
        .hero-title .glitch::before,
        .hero-title .glitch::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .hero-title .glitch::before {
            left: 2px;
            text-shadow: -2px 0 var(--lab-blue);
            clip: rect(44px, 450px, 56px, 0);
            animation: glitch 3s infinite linear alternate-reverse;
        }
        
        .hero-title .glitch::after {
            left: -2px;
            text-shadow: -2px 0 var(--primary);
            clip: rect(44px, 450px, 56px, 0);
            animation: glitch 2s infinite linear alternate-reverse;
        }
        
        .hero-subtitle {
            font-size: 1.5rem;
            margin-bottom: 30px;
            color: var(--text-secondary);
        }
        
        .hero-image {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 50%;
            max-width: 600px;
            animation: float 6s ease-in-out infinite;
            text-align: center;
            z-index: 1;
        }
        
        .hero-character {
            width: 100%;
            max-width: 500px;
            border-radius: 10px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            animation: float 6s ease-in-out infinite;
        }
        
        .hero-bg-element {
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle, var(--primary) 0%, transparent 70%);
            opacity: 0.1;
            top: 10%;
            right: 20%;
            animation: pulse 4s ease-in-out infinite;
        }
        
        /* Секция "О персонаже" */
        .about {
            background-color: var(--bg-card);
            position: relative;
        }
        
        .about-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            align-items: center;
        }
        
        .about-text {
            animation: slideInLeft 1s ease-out;
        }
        
        .about-image {
            text-align: center;
            animation: slideInRight 1s ease-out;
        }
        
        .about-image img {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 30px;
        }
        
        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .stat-item:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        /* =========================================== */
        /* СЕКЦИЯ "НАУЧНЫЕ ДОСТИЖЕНИЯ" */
        /* =========================================== */
        .achievements {
            background: linear-gradient(135deg, rgba(10, 10, 18, 0.95), rgba(21, 21, 34, 0.98));
            position: relative;
            overflow: hidden;
        }
        
        .achievements::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(198, 40, 40, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(41, 121, 255, 0.1) 0%, transparent 40%);
            z-index: 0;
        }
        
        .tabs-wrapper {
            display: flex;
            flex-direction: column;
            gap: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .tabs-header {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 25px;
            margin-bottom: 10px;
        }
        
        .tab-btn {
            width: 100%;
            height: 380px;
            aspect-ratio: 2/3;
            background: linear-gradient(145deg, rgba(21, 21, 34, 0.9), rgba(10, 10, 18, 0.95));
            color: var(--text);
            border: 2px solid rgba(198, 40, 40, 0.3);
            padding: 35px 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            border-radius: 12px;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .tab-btn:hover {
            transform: translateY(-10px);
            border-color: var(--primary);
            box-shadow: 
                0 20px 40px rgba(198, 40, 40, 0.3),
                0 0 40px rgba(198, 40, 40, 0.2),
                inset 0 0 30px rgba(255, 95, 82, 0.2);
        }
        
        .tab-btn.active {
            background: linear-gradient(145deg, rgba(198, 40, 40, 0.15), rgba(142, 0, 0, 0.25));
            border-color: var(--primary);
            box-shadow: 
                0 15px 40px rgba(198, 40, 40, 0.4),
                0 0 50px rgba(198, 40, 40, 0.3),
                inset 0 0 25px rgba(255, 95, 82, 0.1);
            transform: translateY(-8px);
        }
        
        .tab-btn.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            animation: pulse 2s infinite;
        }
        
        .tab-btn-icon {
            font-size: 3.5rem;
            color: var(--primary);
            transition: all 0.3s ease;
            margin-bottom: 25px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .tab-btn.active .tab-btn-icon {
            color: var(--primary-light);
            animation: float 3s ease-in-out infinite;
            text-shadow: 0 0 20px rgba(255, 95, 82, 0.5);
        }
        
        .tab-btn-title {
            font-size: 1.4rem;
            color: var(--text);
            line-height: 1.3;
            font-weight: 700;
            margin-bottom: 20px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .tab-btn.active .tab-btn-title {
            text-shadow: 0 0 15px rgba(255, 95, 82, 0.5);
        }
        
        .tab-btn-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            width: 100%;
        }
        
        .tab-btn-description {
            font-size: 1rem;
            color: var(--text-secondary);
            line-height: 1.6;
            display: -webkit-box;
            -webkit-line-clamp: 8;
            -webkit-box-orient: vertical;
            overflow: hidden;
            transition: all 0.3s ease;
            padding: 0 5px;
        }
        
        .tab-btn:hover .tab-btn-description {
            color: var(--text);
        }
        
        .tab-btn.active .tab-btn-description {
            color: var(--text);
        }
        
        .tab-btn::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, 
                transparent, 
                transparent, 
                rgba(198, 40, 40, 0.1), 
                transparent, 
                transparent);
            border-radius: 14px;
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .tab-btn.active::after {
            opacity: 1;
            animation: rotateGradient 3s linear infinite;
        }
        
        /* МОДАЛЬНОЕ ОКНО */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            z-index: 9998;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            width: 90%;
            max-width: 1200px;
            height: 85vh;
            max-height: 700px;
            background: linear-gradient(135deg, rgba(21, 21, 34, 0.98), rgba(10, 10, 18, 0.99));
            border-radius: 20px;
            border: 2px solid rgba(198, 40, 40, 0.4);
            box-shadow: 
                0 30px 80px rgba(0, 0, 0, 0.8),
                0 0 80px rgba(198, 40, 40, 0.4),
                inset 0 0 50px rgba(255, 255, 255, 0.1);
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            overflow: hidden;
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
        }
        
        .modal-content.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }
        
        .modal-header {
            padding: 25px 40px;
            background: linear-gradient(90deg, rgba(198, 40, 40, 0.2), transparent);
            border-bottom: 1px solid rgba(198, 40, 40, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 2.2rem;
            color: var(--primary);
            text-shadow: 0 0 20px rgba(198, 40, 40, 0.5);
            margin: 0;
        }
        
        .close-modal {
            background: rgba(198, 40, 40, 0.2);
            border: 2px solid rgba(198, 40, 40, 0.4);
            color: var(--text);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-modal:hover {
            background: rgba(198, 40, 40, 0.4);
            transform: rotate(90deg);
            box-shadow: 0 0 20px rgba(198, 40, 40, 0.5);
        }
        
        .modal-body {
            padding: 40px;
            flex: 1;
            overflow-y: auto;
        }
        
        .tab-content-inner {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            align-items: center;
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) 0.2s;
        }
        
        .modal-content.active .tab-content-inner {
            opacity: 1;
            transform: translateY(0);
        }
        
        .achievement-details {
            padding-right: 20px;
        }
        
        .achievement-description {
            margin-bottom: 30px;
            line-height: 1.8;
            font-size: 1.15rem;
            color: var(--text-secondary);
        }
        
        .achievement-features {
            list-style: none;
        }
        
        .achievement-features li {
            margin-bottom: 18px;
            padding-left: 35px;
            position: relative;
            line-height: 1.6;
        }
        
        .achievement-features li::before {
            content: '›';
            position: absolute;
            left: 0;
            color: var(--lab-blue);
            font-size: 1.8rem;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(41, 121, 255, 0.5);
        }
        
        .achievement-visual {
            text-align: center;
            position: relative;
        }
        
        .achievement-visual img {
            max-width: 100%;
            border-radius: 15px;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.5),
                0 0 40px rgba(198, 40, 40, 0.2);
            border: 2px solid rgba(198, 40, 40, 0.4);
            transition: transform 0.5s ease;
        }
        
        .achievement-visual img:hover {
            transform: scale(1.02);
        }
        
        /* ОБНОВЛЕННЫЙ СТИЛЬ ДЛЯ ПОДПИСЕЙ ИЗОБРАЖЕНИЙ */
        .visual-label {
            margin-top: 15px;
            background: rgba(10, 10, 18, 0.85);
            padding: 12px 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            color: var(--lab-blue);
            text-shadow: 0 0 10px rgba(0, 229, 255, 0.7);
            border-radius: 8px;
            border: 1px solid rgba(0, 229, 255, 0.3);
            backdrop-filter: blur(5px);
            text-align: center;
            width: 100%;
        }
        
        /* Анимации для модального окна */
        @keyframes rotateGradient {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes zoomIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes buttonPress {
            0% {
                transform: translateY(-8px) scale(1);
            }
            50% {
                transform: translateY(-8px) scale(0.95);
            }
            100% {
                transform: translateY(-8px) scale(1);
            }
        }
        
        /* Секция "Временная линия" */
        .timeline-section {
            background: linear-gradient(135deg, rgba(10, 10, 18, 0.85), rgba(21, 21, 34, 0.9));
            position: relative;
            overflow: hidden;
            padding: 60px 0;
        }
        
        #raindrop-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }
        
        .timeline-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 18, 0.7);
            z-index: 1;
        }
        
        .timeline-content {
            position: relative;
            z-index: 2;
        }
        
        .timeline {
            position: relative;
            max-width: 1000px;
            margin: 0 auto;
            padding: 50px 0;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 6px;
            background: linear-gradient(
                to bottom,
                transparent,
                var(--timeline-blue),
                var(--timeline-glow),
                var(--timeline-blue),
                transparent
            );
            transform: translateX(-50%);
            border-radius: 10px;
            box-shadow: 
                0 0 40px var(--timeline-blue),
                0 0 80px var(--timeline-glow),
                inset 0 0 20px rgba(0, 229, 255, 0.3);
            animation: glow 3s ease-in-out infinite;
            z-index: 2;
        }
        
        .timeline-pulse {
            position: absolute;
            left: 50%;
            top: 0;
            width: 8px;
            height: 150px;
            background: linear-gradient(
                to bottom,
                transparent,
                var(--timeline-blue),
                var(--timeline-glow),
                var(--timeline-blue),
                transparent
            );
            transform: translateX(-50%);
            animation: pulseFlow 8s ease-in-out infinite;
            border-radius: 10px;
            filter: blur(3px);
            z-index: 3;
            box-shadow: 0 0 50px var(--timeline-blue);
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 100px;
            width: 50%;
            padding: 0 40px;
            opacity: 0;
            transform: translateY(50px);
            transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .timeline-item.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .timeline-item:nth-child(odd) {
            left: 0;
        }
        
        .timeline-item:nth-child(even) {
            left: 50%;
        }
        
        .timeline-btn {
            background: linear-gradient(135deg, rgba(21, 21, 34, 0.85), rgba(10, 10, 18, 0.9));
            padding: 35px;
            border-radius: 20px;
            box-shadow: 
                0 15px 40px rgba(0, 0, 0, 0.6),
                0 0 40px rgba(0, 229, 255, 0.25),
                inset 0 0 20px rgba(255, 255, 255, 0.05);
            position: relative;
            border: 1px solid rgba(0, 229, 255, 0.4);
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
            overflow: hidden;
            backdrop-filter: blur(10px);
            cursor: pointer;
            width: 100%;
            text-align: left;
            border: none;
            color: inherit;
            font-size: inherit;
        }
        
        .timeline-btn:hover {
            transform: translateY(-15px) translateZ(50px);
            box-shadow: 
                0 25px 60px rgba(0, 0, 0, 0.7),
                0 0 70px rgba(0, 229, 255, 0.4),
                inset 0 0 30px rgba(0, 229, 255, 0.15);
            border-color: var(--timeline-blue);
        }
        
        .timeline-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--timeline-blue), transparent);
            animation: pulse 2s infinite;
        }
        
        .timeline-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: radial-gradient(circle, var(--timeline-blue), var(--timeline-glow));
            border: 4px solid var(--bg-dark);
            animation: nodePulse 2s ease-in-out infinite;
            box-shadow: 
                0 0 0 0 rgba(0, 229, 255, 0.9),
                0 0 30px var(--timeline-blue),
                0 0 50px rgba(0, 229, 255, 0.4);
            transform: translateY(-50%);
            z-index: 4;
        }
        
        .timeline-item:nth-child(odd) .timeline-btn::after {
            right: -52px;
        }
        
        .timeline-item:nth-child(even) .timeline-btn::after {
            left: -52px;
        }
        
        .timeline-date {
            color: var(--timeline-blue);
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 20px rgba(0, 229, 255, 0.8);
            font-size: 1.2rem;
            position: relative;
            padding-left: 35px;
            transform: translateZ(30px);
        }
        
        .timeline-date i {
            margin-right: 15px;
            animation: glow 2s ease-in-out infinite;
            position: absolute;
            left: 0;
            font-size: 1.3rem;
            color: var(--timeline-blue);
        }
        
        .timeline-text {
            color: var(--text);
            line-height: 1.7;
            font-size: 1.1rem;
            position: relative;
            z-index: 2;
            transform: translateZ(20px);
            transition: transform 0.3s;
        }
        
        .timeline-btn:hover .timeline-text {
            transform: translateZ(50px);
        }
        
        .world-lines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            opacity: 0.3;
        }
        
        .world-line {
            position: absolute;
            color: var(--lab-green);
            font-family: 'Courier New', monospace;
            font-size: 14px;
            font-weight: bold;
            text-shadow: 0 0 10px var(--lab-green);
            animation: fadeIn 1s;
        }
        
        /* МОДАЛЬНОЕ ОКНО ДЛЯ ВРЕМЕННОЙ ЛИНИИ */
        .timeline-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(10px);
            z-index: 9998;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .timeline-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .timeline-modal-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            width: 90%;
            max-width: 1000px;
            height: 85vh;
            max-height: 700px;
            background: linear-gradient(135deg, rgba(21, 21, 34, 0.98), rgba(10, 10, 18, 0.99));
            border-radius: 20px;
            border: 2px solid rgba(0, 229, 255, 0.4);
            box-shadow: 
                0 30px 80px rgba(0, 0, 0, 0.8),
                0 0 80px rgba(0, 229, 255, 0.4),
                inset 0 0 50px rgba(255, 255, 255, 0.1);
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            overflow: hidden;
            transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
        }
        
        .timeline-modal-content.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }
        
        .timeline-modal-header {
            padding: 25px 40px;
            background: linear-gradient(90deg, rgba(0, 229, 255, 0.2), transparent);
            border-bottom: 1px solid rgba(0, 229, 255, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .timeline-modal-title {
            font-size: 2rem;
            color: var(--timeline-blue);
            text-shadow: 0 0 20px rgba(0, 229, 255, 0.5);
            margin: 0;
            font-family: 'Courier New', monospace;
        }
        
        .timeline-close-modal {
            background: rgba(0, 229, 255, 0.2);
            border: 2px solid rgba(0, 229, 255, 0.4);
            color: var(--text);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .timeline-close-modal:hover {
            background: rgba(0, 229, 255, 0.4);
            transform: rotate(90deg);
            box-shadow: 0 0 20px rgba(0, 229, 255, 0.5);
        }
        
        .timeline-modal-body {
            padding: 40px;
            flex: 1;
            overflow-y: auto;
        }
        
        .timeline-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 50px;
            align-items: center;
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) 0.2s;
        }
        
        .timeline-modal-content.active .timeline-details {
            opacity: 1;
            transform: translateY(0);
        }
        
        .timeline-description {
            padding-right: 20px;
        }
        
        .timeline-full-description {
            margin-bottom: 30px;
            line-height: 1.8;
            font-size: 1.15rem;
            color: var(--text-secondary);
        }
        
        .timeline-features {
            list-style: none;
            margin-top: 30px;
        }
        
        .timeline-features li {
            margin-bottom: 18px;
            padding-left: 35px;
            position: relative;
            line-height: 1.6;
        }
        
        .timeline-features li::before {
            content: '›';
            position: absolute;
            left: 0;
            color: var(--timeline-blue);
            font-size: 1.8rem;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(0, 229, 255, 0.5);
        }
        
        .timeline-visual {
            text-align: center;
            position: relative;
        }
        
        .timeline-visual img {
            max-width: 100%;
            border-radius: 15px;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.5),
                0 0 40px rgba(0, 229, 255, 0.2);
            border: 2px solid rgba(0, 229, 255, 0.4);
            transition: transform 0.5s ease;
        }
        
        .timeline-visual img:hover {
            transform: scale(1.02);
        }
        
        /* Стиль для подписей изображений в мировых линиях */
        .timeline-visual-label {
            margin-top: 15px;
            background: rgba(10, 10, 18, 0.85);
            padding: 12px 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.95rem;
            color: var(--timeline-blue);
            text-shadow: 0 0 10px rgba(0, 229, 255, 0.7);
            border-radius: 8px;
            border: 1px solid rgba(0, 229, 255, 0.3);
            backdrop-filter: blur(5px);
            text-align: center;
            width: 100%;
        }
        
        /* Секция "Галерея" */
        .gallery {
            background: var(--bg-card);
        }
        
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .gallery-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            height: 250px;
            background: var(--bg-dark);
            transition: all 0.3s ease;
        }
        
        .gallery-item:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(198, 40, 40, 0.3);
        }
        
        .gallery-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }
        
        .gallery-item:hover .gallery-img {
            transform: scale(1.1);
        }
        
        .gallery-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(10, 10, 18, 0.8);
            padding: 15px;
            transform: translateY(100%);
            transition: transform 0.3s;
        }
        
        .gallery-item:hover .gallery-caption {
            transform: translateY(0);
        }
        
        /* =========================================== */
        /* СЕКЦИЯ С ПЛЕЕРОМ СЕРИЙ */
        /* =========================================== */
        .episodes-section {
            padding: 60px 0;
            background: var(--bg-dark);
            position: relative;
        }
        
        .episodes-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .episodes-title {
            font-size: 2.2rem;
            margin-bottom: 30px;
            color: var(--primary);
            text-align: center;
        }
        
        .episodes-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }
        
        .episode-player {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            border: 2px solid var(--primary);
            background: #000;
            width: 100%;
            height: 550px;
        }
        
        /* УЛУЧШЕННЫЙ СТИЛЬ ДЛЯ IFRAME GOOGLE DRIVE */
        .video-iframe-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        .video-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: #000;
        }
        
        .video-iframe iframe {
            width: 100%;
            height: 100%;
            border: none;
            pointer-events: auto;
        }
        
        /* Скрываем элементы управления средствами CSS */
        .video-iframe iframe::-webkit-media-controls {
            display: none !important;
        }
        
        .video-iframe iframe::-webkit-media-controls-enclosure {
            display: none !important;
        }
        
        .video-iframe iframe::-webkit-media-controls-panel {
            display: none !important;
        }
        
        .video-iframe iframe::-webkit-media-controls-play-button {
            display: none !important;
        }
        
        .video-iframe iframe::-webkit-media-controls-volume-slider {
            display: none !important;
        }
        
        .video-iframe iframe::-webkit-media-controls-mute-button {
            display: none !important;
        }
        
        .video-iframe iframe::-webkit-media-controls-timeline {
            display: none !important;
        }
        
        .video-iframe iframe::-webkit-media-controls-current-time-display {
            display: none !important;
        }
        
        .video-iframe iframe::-webkit-media-controls-time-remaining-display {
            display: none !important;
        }
        
        .video-iframe iframe::-webkit-media-controls-fullscreen-button {
            display: none !important;
        }
        
        /* Для Firefox */
        .video-iframe iframe::-moz-media-controls {
            display: none !important;
        }
        
        .episodes-list {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            max-height: 550px;
            overflow-y: auto;
        }
        
        .episodes-list-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--primary);
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .episode-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }
        
        .episode-item:hover:not(.disabled) {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }
        
        .episode-item.active {
            background: rgba(198, 40, 40, 0.2);
            border-left: 3px solid var(--primary);
        }
        
        .episode-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .episode-number {
            font-weight: bold;
            color: var(--primary);
            margin-right: 10px;
        }
        
        .episode-name {
            color: var(--text);
            font-weight: 500;
        }
        
        .episode-duration {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-top: 5px;
        }
        
        .video-loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 18, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }
        
        .loading-spinner {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 20px;
            animation: spin 1s linear infinite;
        }
        
        /* Футер */
        footer {
            background: var(--bg-card);
            padding: 60px 0 30px;
            text-align: center;
        }
        
        .footer-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .lab-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.05);
            padding: 10px 20px;
            border-radius: 30px;
            margin: 20px 0;
            border: 1px solid var(--primary);
            font-family: 'Courier New', monospace;
        }
        
        .el-psy-congroo {
            font-family: 'Courier New', monospace;
            margin-top: 30px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        /* Бинарный фон */
        .binary-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.1;
        }
        
        /* Частицы */
        .particles-js {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: -1;
        }

        /* =========================================== */
        /* АДАПТИВНОСТЬ ДЛЯ МОБИЛЬНЫХ УСТРОЙСТВ */
        /* =========================================== */
        
        @media (max-width: 1200px) {
            .tabs-header {
                grid-template-columns: repeat(2, 1fr);
                gap: 25px;
            }
            
            .tab-btn {
                height: 350px;
                padding: 30px 20px;
            }
            
            .tab-btn-title {
                font-size: 1.3rem;
            }
            
            .tab-btn-description {
                -webkit-line-clamp: 7;
            }
            
            .modal-content {
                max-height: 80vh;
            }
            
            .episodes-content {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            
            .episodes-list {
                max-height: 300px;
            }
            
            .episode-player {
                height: 500px;
            }
        }
        
        @media (max-width: 992px) {
            .tab-content-inner {
                grid-template-columns: 1fr;
                gap: 40px;
            }
            
            .achievement-details {
                padding-right: 0;
            }
            
            .tab-btn {
                height: 320px;
                padding: 25px 18px;
            }
            
            .tab-btn-title {
                font-size: 1.25rem;
                height: 55px;
            }
            
            .tab-btn-icon {
                font-size: 3.2rem;
                margin-bottom: 20px;
                height: 70px;
            }
            
            .tab-btn-description {
                font-size: 0.95rem;
                -webkit-line-clamp: 6;
            }
            
            .modal-body {
                padding: 30px;
            }
            
            .modal-header {
                padding: 20px 30px;
            }
            
            .modal-title {
                font-size: 1.8rem;
            }
            
            .timeline::before {
                left: 30px;
            }
            
            .timeline-pulse {
                left: 30px;
            }
            
            .timeline-item {
                width: 100%;
                left: 0 !important;
                padding-left: 80px;
                padding-right: 20px;
            }
            
            .timeline-btn::after {
                left: -52px !important;
                right: auto !important;
            }
            
            .timeline-details {
                grid-template-columns: 1fr;
                gap: 40px;
            }
            
            .timeline-description {
                padding-right: 0;
            }
            
            /* Адаптация для мобильных */
            .hero-container {
                flex-direction: column;
                justify-content: center;
                text-align: center;
                padding-top: 60px;
            }
            
            .hero-content {
                max-width: 100%;
                margin-bottom: 40px;
                padding: 0 20px;
            }
            
            .hero-image {
                position: relative;
                width: 100%;
                max-width: 500px;
                margin: 0 auto;
                top: auto;
                transform: none;
                right: auto;
            }
            
            .hero-bg-element {
                display: none;
            }
            
            .hero-title {
                font-size: 2.8rem;
            }
            
            .hero-subtitle {
                font-size: 1.3rem;
            }
            
            .about-content {
                grid-template-columns: 1fr;
                gap: 40px;
            }
            
            .about-image {
                order: -1;
            }
            
            /* Оптимизация плеера для планшетов */
            .episode-player {
                height: 450px;
            }
            
            /* Адаптация для авторизации */
            .user-name {
                display: none;
            }
            
            .auth-buttons {
                gap: 8px;
            }
            
            .auth-btn {
                padding: 4px 12px;
                font-size: 0.8rem;
                height: 28px;
            }
            
            .auth-modal-body {
                padding: 20px;
            }
            
            .auth-modal-header {
                padding: 15px 20px;
            }
            
            .auth-modal-title {
                font-size: 1.4rem;
            }
            
            .auth-modal {
                max-width: 95%;
            }
            
            /* Адаптация профиля */
            .profile-content {
                grid-template-columns: 1fr;
            }
            
            .profile-main-title {
                font-size: 2.2rem;
            }
        }
        
        @media (max-width: 768px) {
            section {
                padding: 50px 0;
            }
            
            .section-title {
                font-size: 2rem;
                margin-bottom: 2rem;
            }
            
            .tabs-header {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .tab-btn {
                height: 280px;
                padding: 22px 15px;
                max-width: 400px;
                margin: 0 auto;
            }
            
            .tab-btn-icon {
                font-size: 3rem;
                margin-bottom: 18px;
                height: 65px;
            }
            
            .tab-btn-title {
                font-size: 1.2rem;
                height: 50px;
                margin-bottom: 15px;
            }
            
            .tab-btn-description {
                font-size: 0.9rem;
                -webkit-line-clamp: 5;
            }
            
            .modal-content {
                width: 95%;
                height: 90vh;
                max-height: none;
            }
            
            .modal-title {
                font-size: 1.6rem;
            }
            
            .achievement-description {
                font-size: 1.1rem;
            }
            
            /* Навигация для мобильных */
            .nav-links {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .nav-links li {
                margin: 0 5px;
            }
            
            .nav-links a {
                font-size: 0.9rem;
                padding: 8px 5px;
            }
            
            .hero {
                height: auto;
                min-height: 100vh;
            }
            
            .hero-title {
                font-size: 2.5rem;
            }
            
            .hero-subtitle {
                font-size: 1.2rem;
            }
            
            .hero-character {
                max-width: 400px;
            }
            
            .stats {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .stat-item {
                padding: 15px;
            }
            
            .stat-value {
                font-size: 1.8rem;
            }
            
            .gallery-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .gallery-item {
                height: 200px;
            }
            
            .timeline-item {
                padding-left: 60px;
                margin-bottom: 60px;
            }
            
            .timeline-btn {
                padding: 25px;
            }
            
            .timeline-date {
                font-size: 1.1rem;
            }
            
            .timeline-text {
                font-size: 1rem;
            }
            
            .timeline-modal-content {
                width: 95%;
                height: 90vh;
                max-height: none;
            }
            
            .timeline-modal-title {
                font-size: 1.6rem;
            }
            
            .timeline-modal-body {
                padding: 30px;
            }
            
            .timeline-modal-header {
                padding: 20px 30px;
            }
            
            .episode-player {
                height: 380px;
                margin-bottom: 20px;
            }
            
            .episodes-content {
                gap: 20px;
            }
            
            .episodes-list {
                max-height: 350px;
            }
            
            .video-iframe {
                transform: scale(1);
            }
            
            .auth-btn {
                padding: 3px 10px;
                font-size: 0.75rem;
                height: 26px;
            }
            
            .profile-btn {
                padding: 3px 10px;
                font-size: 0.75rem;
                height: 26px;
            }
            
            .user-avatar {
                width: 28px;
                height: 28px;
                font-size: 0.9rem;
            }
            
            .profile-header {
                margin-bottom: 30px;
            }
            
            .profile-main-title {
                font-size: 2rem;
                flex-direction: column;
                gap: 10px;
            }
            
            .profile-status {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            
            .profile-avatar-large {
                width: 150px;
                height: 150px;
                font-size: 2.8rem;
            }
            
            .profile-info-grid {
                grid-template-columns: 1fr;
            }
            
            .profile-tabs {
                flex-wrap: wrap;
            }
            
            .profile-actions {
                flex-direction: column;
                align-items: center;
            }
        }
        
        @media (max-width: 576px) {
            .container {
                padding: 0 15px;
            }
            
            section {
                padding: 40px 0;
            }
            
            .section-title {
                font-size: 1.8rem;
                margin-bottom: 1.5rem;
            }
            
            .nav-links {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 5px;
            }
            
            .nav-links li {
                margin: 0;
                text-align: center;
            }
            
            .nav-links a {
                font-size: 0.85rem;
                padding: 8px 3px;
                display: block;
            }
            
            .hero-title {
                font-size: 2.2rem;
            }
            
            .hero-subtitle {
                font-size: 1.1rem;
            }
            
            .btn {
                padding: 10px 25px;
                font-size: 0.9rem;
            }
            
            .tabs-header {
                gap: 15px;
            }
            
            .tab-btn {
                height: 250px;
                padding: 20px 15px;
            }
            
            .tab-btn-icon {
                font-size: 2.5rem;
                margin-bottom: 15px;
                height: 50px;
            }
            
            .tab-btn-title {
                font-size: 1.1rem;
                height: 40px;
                margin-bottom: 10px;
            }
            
            .tab-btn-description {
                font-size: 0.85rem;
                -webkit-line-clamp: 4;
            }
            
            .modal-body {
                padding: 20px;
            }
            
            .modal-header {
                padding: 15px 20px;
            }
            
            .modal-title {
                font-size: 1.4rem;
            }
            
            .close-modal {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
            
            .achievement-description {
                font-size: 1rem;
            }
            
            .achievement-features li {
                font-size: 0.9rem;
                padding-left: 30px;
                margin-bottom: 12px;
            }
            
            .stats {
                gap: 10px;
            }
            
            .stat-item {
                padding: 12px;
            }
            
            .stat-value {
                font-size: 1.6rem;
            }
            
            .stat-label {
                font-size: 0.8rem;
            }
            
            .gallery-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .gallery-item {
                height: 250px;
            }
            
            .timeline-item {
                padding-left: 50px;
                margin-bottom: 50px;
            }
            
            .timeline-btn {
                padding: 20px;
            }
            
            .timeline-btn::after {
                left: -45px !important;
                width: 20px;
                height: 20px;
            }
            
            .timeline-date {
                font-size: 1rem;
                padding-left: 30px;
            }
            
            .timeline-text {
                font-size: 0.95rem;
            }
            
            .timeline-modal-body {
                padding: 20px;
            }
            
            .timeline-modal-header {
                padding: 15px 20px;
            }
            
            .timeline-modal-title {
                font-size: 1.4rem;
            }
            
            .timeline-close-modal {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
            
            .episode-player {
                height: 320px;
            }
            
            .episodes-list {
                max-height: 300px;
            }
            
            .episode-item {
                padding: 10px 12px;
            }
            
            .episode-name {
                font-size: 0.9rem;
            }
            
            .auth-btn {
                padding: 3px 8px;
                font-size: 0.7rem;
                height: 24px;
            }
            
            .profile-btn {
                padding: 3px 8px;
                font-size: 0.7rem;
                height: 24px;
            }
            
            .user-avatar {
                width: 24px;
                height: 24px;
                font-size: 0.8rem;
            }
            
            .profile-page {
                padding: 80px 15px 40px;
            }
            
            .profile-main-title {
                font-size: 1.8rem;
            }
            
            .profile-user-name {
                font-size: 1.5rem;
            }
            
            .profile-avatar-large {
                width: 120px;
                height: 120px;
                font-size: 2.2rem;
            }
        }
        
        @media (max-width: 375px) {
            .hero-title {
                font-size: 1.8rem;
            }
            
            .hero-subtitle {
                font-size: 1rem;
            }
            
            .nav-links {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .nav-links li:nth-child(5) {
                grid-column: span 2;
                margin-top: 5px;
            }
            
            .section-title {
                font-size: 1.6rem;
            }
            
            .tab-btn {
                height: 230px;
                padding: 15px 12px;
            }
            
            .tab-btn-icon {
                font-size: 2.2rem;
            }
            
            .tab-btn-title {
                font-size: 1rem;
            }
            
            .timeline-btn {
                padding: 15px;
            }
            
            .timeline-date {
                font-size: 0.9rem;
            }
            
            .timeline-text {
                font-size: 0.9rem;
            }
            
            .episode-player {
                height: 280px;
            }
            
            .auth-btn {
                padding: 2px 6px;
                font-size: 0.65rem;
                height: 22px;
            }
        }
        
        /* Стили для скроллбара */
        .modal-body::-webkit-scrollbar,
        .timeline-modal-body::-webkit-scrollbar,
        .episodes-list::-webkit-scrollbar,
        .auth-modal-body::-webkit-scrollbar,
        .profile-main::-webkit-scrollbar {
            width: 8px;
        }
        
        .modal-body::-webkit-scrollbar-track {
            background: rgba(198, 40, 40, 0.1);
            border-radius: 4px;
        }
        
        .modal-body::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, var(--primary), var(--primary-dark));
            border-radius: 4px;
        }
        
        .modal-body::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, var(--primary-light), var(--primary));
        }
        
        .timeline-modal-body::-webkit-scrollbar-track {
            background: rgba(0, 229, 255, 0.1);
            border-radius: 4px;
        }
        
        .timeline-modal-body::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, var(--timeline-blue), var(--timeline-glow));
            border-radius: 4px;
        }
        
        .timeline-modal-body::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, var(--timeline-glow), var(--timeline-blue));
        }
        
        .episodes-list::-webkit-scrollbar-track {
            background: rgba(41, 121, 255, 0.1);
            border-radius: 4px;
        }
        
        .episodes-list::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, var(--lab-blue), var(--secondary-light));
            border-radius: 4px;
        }
        
        .auth-modal-body::-webkit-scrollbar-track {
            background: rgba(198, 40, 40, 0.1);
            border-radius: 4px;
        }
        
        .auth-modal-body::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, var(--primary), var(--primary-dark));
            border-radius: 4px;
        }
        
        .profile-main::-webkit-scrollbar-track {
            background: rgba(41, 121, 255, 0.1);
            border-radius: 4px;
        }
        
        .profile-main::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, var(--lab-blue), var(--secondary-light));
            border-radius: 4px;
        }
        
        /* Улучшение для касаний на мобильных */
        @media (hover: none) and (pointer: coarse) {
            .tab-btn:hover {
                transform: none;
            }
            
            .stat-item:hover {
                transform: none;
            }
            
            .gallery-item:hover {
                transform: none;
            }
            
            .timeline-btn:hover {
                transform: none;
            }
            
            .episode-item:hover:not(.disabled) {
                transform: none;
            }
            
            .btn:hover {
                transform: none;
            }
            
            .auth-btn:hover {
                transform: none;
            }
            
            .profile-btn:hover {
                transform: none;
            }
            
            .profile-stat-item:hover {
                transform: none;
            }
            
            /* Увеличение областей клика для мобильных */
            .tab-btn,
            .stat-item,
            .episode-item,
            .timeline-btn,
            .btn,
            .auth-btn,
            .profile-btn,
            .profile-stat-item {
                cursor: pointer;
                -webkit-tap-highlight-color: transparent;
            }
            
            .nav-links a {
                padding: 10px 5px;
                -webkit-tap-highlight-color: transparent;
            }
            
            /* Оптимизация плеера для тач-устройств */
            .episode-player {
                touch-action: manipulation;
            }
            
            .video-iframe {
                touch-action: pan-x pan-y pinch-zoom;
            }
        }
    </style>
</head>
<body>
    <!-- Бинарный фон с мировыми линиями -->
    <div class="binary-bg" id="binaryBg"></div>
    
    <!-- Частицы -->
    <div id="particles-js" class="particles-js"></div>
    
    <!-- Навигация с авторизацией -->
    <nav>
        <div class="container nav-auth-container">
            <!-- Навигационные ссылки -->
            <ul class="nav-links">
                <li><a href="#about">О персонаже</a></li>
                <li><a href="#achievements">Научные достижения</a></li>
                <li><a href="#timeline">Временная линия</a></li>
                <li><a href="#gallery">Галерея</a></li>
                <li><a href="#episodes">Серии</a></li>
            </ul>
            
            <!-- Кнопки авторизации -->
            <div class="auth-buttons" id="authButtons">
                <button class="auth-btn login-btn" id="openLoginModal">
                    <i class="fas fa-sign-in-alt"></i> Войти
                </button>
                <button class="auth-btn register-btn" id="openRegisterModal">
                    <i class="fas fa-user-plus"></i> Регистрация
                </button>
            </div>
            
            <!-- Информация о пользователе -->
            <div class="user-info" id="userInfo" style="display: none;">
                <div class="user-avatar" id="userAvatar">П</div>
                <span class="user-name" id="userName"></span>
                <button class="profile-btn" id="profileBtn">
                    <i class="fas fa-user"></i> Профиль
                </button>
            </div>
        </div>
    </nav>

    <!-- Модальное окно авторизации -->
    <div class="auth-modal-overlay" id="authModalOverlay"></div>
    
    <div class="auth-modal" id="authModal">
        <div class="auth-modal-header">
            <h3 class="auth-modal-title" id="authModalTitle">Вход</h3>
            <button class="auth-close-modal" id="closeAuthModal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="auth-modal-body">
            <div class="auth-tabs">
                <button class="auth-tab-btn active" id="loginTabBtn">Вход</button>
                <button class="auth-tab-btn" id="registerTabBtn">Регистрация</button>
            </div>
            
            <!-- Форма входа -->
            <form class="auth-form active" id="loginForm">
                <div class="auth-message" id="loginMessage"></div>
                
                <div class="auth-form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" class="auth-form-control" placeholder="Введите ваш email" required>
                </div>
                
                <div class="auth-form-group">
                    <label for="loginPassword">Пароль</label>
                    <div class="auth-password-field">
                        <input type="password" id="loginPassword" class="auth-form-control" placeholder="Введите пароль" required>
                        <button type="button" class="auth-toggle-password" data-target="loginPassword">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div class="auth-form-check">
                    <input type="checkbox" id="rememberMe">
                    <label for="rememberMe">Запомнить меня</label>
                </div>
                
                <button type="submit" class="auth-form-btn">
                    <i class="fas fa-sign-in-alt"></i> Войти
                </button>
            </form>
            
            <!-- Форма регистрации -->
            <form class="auth-form" id="registerForm">
                <div class="auth-message" id="registerMessage"></div>
                
                <div class="auth-form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" class="auth-form-control" placeholder="Введите ваш email" required>
                </div>
                
                <div class="auth-form-group">
                    <label for="registerUsername">Имя пользователя</label>
                    <input type="text" id="registerUsername" class="auth-form-control" placeholder="Придумайте имя пользователя" required>
                </div>
                
                <div class="auth-form-group">
                    <label for="registerPassword">Пароль</label>
                    <div class="auth-password-field">
                        <input type="password" id="registerPassword" class="auth-form-control" placeholder="Придумайте пароль (мин. 6 символов)" required>
                        <button type="button" class="auth-toggle-password" data-target="registerPassword">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div class="auth-form-group">
                    <label for="registerConfirmPassword">Подтвердите пароль</label>
                    <div class="auth-password-field">
                        <input type="password" id="registerConfirmPassword" class="auth-form-control" placeholder="Повторите пароль" required>
                        <button type="button" class="auth-toggle-password" data-target="registerConfirmPassword">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div class="auth-form-check">
                    <input type="checkbox" id="acceptTerms" required>
                    <label for="acceptTerms">Я согласен с условиями использования</label>
                </div>
                
                <button type="submit" class="auth-form-btn">
                    <i class="fas fa-user-plus"></i> Зарегистрироваться
                </button>
            </form>
        </div>
    </div>
    
    <!-- Модальное окно редактирования профиля -->
    <div class="auth-modal-overlay" id="editProfileModalOverlay"></div>
    
    <div class="edit-profile-modal" id="editProfileModal">
        <div class="edit-profile-modal-header">
            <h3 class="edit-profile-modal-title">Редактирование профиля</h3>
            <button class="edit-profile-close-modal" id="closeEditProfileModal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="edit-profile-modal-body">
            <form class="edit-profile-form" id="editProfileForm">
                <div class="edit-profile-form-group">
                    <label class="edit-profile-form-label" for="editProfileName">Имя пользователя</label>
                    <input type="text" id="editProfileName" class="edit-profile-form-control" placeholder="Введите новое имя пользователя">
                </div>
                
                <button type="submit" class="edit-profile-form-btn">
                    <i class="fas fa-save"></i> Сохранить изменения
                </button>
            </form>
        </div>
    </div>
    
    <!-- Модальное окно комментариев -->
    <div class="comments-modal-overlay" id="commentsModalOverlay"></div>
    
    <div class="comments-modal" id="commentsModal">
        <div class="comments-modal-header">
            <h3 class="comments-modal-title">
                <i class="fas fa-comments"></i> Комментарии
            </h3>
            <button class="comments-close-modal" id="commentsCloseModal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="comments-modal-body">
            <div class="comment-form" id="modalCommentForm">
                <h4 class="comment-form-title">
                    <i class="fas fa-edit"></i> Оставить комментарий
                </h4>
                <div class="comment-input-container">
                    <div class="comment-input-wrapper">
                        <textarea 
                            class="comment-textarea" 
                            id="modalCommentText" 
                            placeholder="Напишите ваш комментарий..." 
                            maxlength="500"
                        ></textarea>
                        <div class="comment-form-actions">
                            <div class="comment-char-count" id="modalCharCount">0/500</div>
                            <button type="button" class="comment-submit-btn" id="modalSubmitComment">
                                <i class="fas fa-paper-plane"></i> Отправить
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="comments-list" id="modalCommentsList">
                <!-- Комментарии будут загружаться сюда -->
            </div>
        </div>
    </div>
    
    <!-- Страница профиля -->
    <div class="profile-page" id="profilePage">
        <div class="container profile-container">
            <div class="profile-header">
                <h1 class="profile-main-title">Лабораторный профиль</h1>
            </div>
            
            <div class="profile-content">
                <div class="profile-sidebar">
                    <div class="profile-avatar-section">
                        <div class="profile-avatar-large" id="profileAvatarLarge">П</div>
                        <input type="file" id="avatarInput" class="avatar-input" accept="image/*">
                        <h2 class="profile-user-name" id="profileUserName">Пользователь</h2>
                        <div class="profile-user-role" id="profileUserRole">Участник Лаборатории</div>
                        <button class="avatar-upload-btn" id="avatarUploadBtn">
                            <i class="fas fa-camera"></i> Загрузить аватар
                        </button>
                    </div>
                </div>
                
                <div class="profile-main">
                    <div class="profile-tabs">
                        <button class="profile-tab-btn active" data-tab="info">
                            <i class="fas fa-info-circle"></i> Информация
                        </button>
                    </div>
                    
                    <div class="profile-tab-content active" id="profileTabInfo">
                        <div class="profile-info-grid">
                            <div class="profile-info-item">
                                <div class="profile-info-label">
                                    <i class="fas fa-envelope"></i> Email
                                </div>
                                <div class="profile-info-value" id="profileEmail">user@example.com</div>
                            </div>
                            <div class="profile-info-item">
                                <div class="profile-info-label">
                                    <i class="fas fa-user-tag"></i> Имя пользователя
                                </div>
                                <div class="profile-info-value" id="profileUsername">username</div>
                            </div>
                            <div class="profile-info-item">
                                <div class="profile-info-label">
                                    <i class="fas fa-id-badge"></i> Лабораторный ID
                                </div>
                                <div class="profile-info-value">LAB-<span id="profileUserId">001</span></div>
                            </div>
                            <div class="profile-info-item">
                                <div class="profile-info-label">
                                    <i class="fas fa-calendar-alt"></i> Дата регистрации
                                </div>
                                <div class="profile-info-value" id="joinDate">25.07.2010</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="profile-actions">
                <button class="back-btn" id="backToMainBtn">
                    <i class="fas fa-arrow-left"></i> Вернуться на главную
                </button>
                <button class="edit-profile-btn" id="editProfileBtn">
                    <i class="fas fa-edit"></i> Редактировать профиль
                </button>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Выйти из аккаунта
                </button>
            </div>
        </div>
    </div>

<!-- Герой секция -->
<section class="hero">
    <div class="container hero-container">
        <div class="hero-content">
            <h1 class="hero-title">
                <span class="glitch" data-text="Макисэ Курису">Макисэ Курису</span>
            </h1>
            <p class="hero-subtitle">Гений-нейробиолог | Член Лаборатории Будущего</p>
            <p>Известный учёный в области нейробиологии, создатель "Машины скачков по памяти" и ключевой член Лаборатории Будущего.</p>
            <a href="#about" class="btn" style="margin-top: 30px;">Узнать больше</a>
        </div>
        <div class="hero-image">
            <div class="hero-bg-element"></div>
            <img src="https://i.postimg.cc/tCRgbBnx/kurisu.png" alt="Макисэ Курису" class="hero-character">
        </div>
    </div>
</section>

<!-- Секция "О персонаже" -->
<section id="about" class="about">
    <div class="container">
        <h2 class="section-title">О персонаже</h2>
        <div class="about-content">
            <div class="about-text">
                <p>Макисэ Курису (牧瀬 紅莉栖) — 18-летний гений в области нейробиологии, известная своими новаторскими исследованиями памяти человека. Несмотря на молодой возраст, она уже имеет публикации в ведущих научных журналах.</p>
                <p>Присоединившись к Лаборатории Будущего, она сыграла ключевую роль в разработке технологии путешествия во времени, создав "Машину скачков по памяти".</p>
                <p>По характеру Курису — классический цундере: внешне холодная и рациональная, но внутри добрая и заботливая. Она часто конфликтует с Окабэ Ринтаро, но в конечном итоге между ними развиваются глубокие чувства.</p>
                
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value">18</div>
                        <div class="stat-label">Возраст</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">AB</div>
                        <div class="stat-label">Группа крови</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">25 июля</div>
                        <div class="stat-label">Дата рождения</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">Цундере</div>
                        <div class="stat-label">Тип личности</div>
                    </div>
                </div>
            </div>
            <div class="about-image">
                <img src="https://i.postimg.cc/xTs11LLL/kurisu-lab.jpg" alt="Курису в лаборатории" class="hero-character">
            </div>
        </div>
    </div>
</section>

<!-- Секция "Научные достижения" -->
<section id="achievements" class="achievements">
    <div class="container">
        <h2 class="section-title">Научные достижения</h2>
        <div class="tabs-container">
            <div class="tabs-wrapper">
                <div class="tabs-header">
                    <button class="tab-btn active" data-tab="memory-jump">
                        <div class="tab-btn-icon">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div class="tab-btn-title">Машина скачков по памяти</div>
                        <div class="tab-btn-info">
                            <div class="tab-btn-description">
                                Инновационное устройство для передачи воспоминаний в прошлое через квантовую телепортацию сознания. Ключевая технология Лаборатории Будущего.
                            </div>
                        </div>
                    </button>
                    
                    <button class="tab-btn" data-tab="neuro-research">
                        <div class="tab-btn-icon">
                            <i class="fas fa-flask"></i>
                        </div>
                        <div class="tab-btn-title">Нейробиологические исследования</div>
                        <div class="tab-btn-info">
                            <div class="tab-btn-description">
                                Прорыв в изучении нейропластичности и квантового кодирования памяти. Открытие механизма "временной волны" в гиппокампе.
                            </div>
                        </div>
                    </button>
                    
                    <button class="tab-btn" data-tab="time-travel">
                        <div class="tab-btn-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="tab-btn-title">Теория путешествий во времени</div>
                        <div class="tab-btn-info">
                            <div class="tab-btn-description">
                                Революционная теория мировых линий и временных парадоксов. Концепция "Притяжения мировой линии" и D-mail системы.
                            </div>
                        </div>
                    </button>
                    
                    <button class="tab-btn" data-tab="publications">
                        <div class="tab-btn-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="tab-btn-title">Научные публикации</div>
                        <div class="tab-btn-info">
                            <div class="tab-btn-description">
                                Публикации в ведущих научных журналах: Science, Nature Physics, PNAS, Cell. Международное признание исследований.
                            </div>
                        </div>
                    </button>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Модальное окно для отображения контента -->
<div class="modal-overlay" id="modalOverlay"></div>

<div class="modal-content" id="modalContent">
    <div class="modal-header">
        <h3 class="modal-title" id="modalTitle">Машина скачков по памяти</h3>
        <button class="close-modal" id="closeModal">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <div class="modal-body">
        <div class="tab-content-inner" id="modalBody">
            <!-- Контент будет загружаться динамически -->
        </div>
    </div>
</div>

<!-- Секция "Временная линия" -->
<section id="timeline" class="timeline-section">
    <!-- Canvas с анимацией капель -->
    <canvas id="raindrop-canvas"></canvas>
    
    <!-- Затемнение фона -->
    <div class="timeline-overlay"></div>
    
    <!-- Мировые линии -->
    <div class="world-lines" id="worldLines"></div>
    
    <div class="container timeline-content">
        <h2 class="section-title">Временная линия</h2>
        
        <div class="timeline">
            <!-- Анимированный импульс -->
            <div class="timeline-pulse"></div>
            
            <!-- Событие 1 -->
            <div class="timeline-item">
                <button class="timeline-btn" data-event="event1">
                    <div class="timeline-date">
                        <i class="far fa-calendar"></i> 28 июля 2010 (Альфа мир)
                    </div>
                    <p class="timeline-text">Первая встреча с Окабэ Ринтаро в лекционном зале Радиокан. Становится свидетельницей создания D-mail и начала временных экспериментов.</p>
                </button>
            </div>
            
            <!-- Событие 2 -->
            <div class="timeline-item">
                <button class="timeline-btn" data-event="event2">
                    <div class="timeline-date">
                        <i class="far fa-calendar"></i> Июль-Август 2010
                    </div>
                    <p class="timeline-text">Присоединяется к Лаборатории Будущего. Помогает усовершенствовать Микроволновку Банано в полноценную Машину времени.</p>
                </button>
            </div>
            
            <!-- Событие 3 -->
            <div class="timeline-item">
                <button class="timeline-btn" data-event="event3">
                    <div class="timeline-date">
                        <i class="far fa-calendar"></i> Август 2010 (Альфа-мир)
                    </div>
                    <p class="timeline-text">Создает "Машину скачков по памяти". Помогает Окабэ найти способ спасти Маюри от неизбежной гибели.</p>
                </button>
            </div>
            
            <!-- Событие 4 -->
            <div class="timeline-item">
                <button class="timeline-btn" data-event="event4">
                    <div class="timeline-date">
                        <i class="far fa-calendar"></i> Конец Августа 2010
                    </div>
                    <p class="timeline-text">Жертвует собой в Альфа-мире, чтобы Окабэ мог достичь Мировой линии Врат Штейна.</p>
                </button>
            </div>
            
            <!-- Событие 5 -->
            <div class="timeline-item">
                <button class="timeline-btn" data-event="event5">
                    <div class="timeline-date">
                        <i class="far fa-calendar"></i> Мир Врат Штейна
                    </div>
                    <p class="timeline-text">Воссоединяется с Окабэ в идеальной мирной линии, где оба спасены от своих судеб.</p>
                </button>
            </div>
        </div>
    </div>
</section>

<!-- Модальное окно для временной линии -->
<div class="timeline-modal-overlay" id="timelineModalOverlay"></div>

<div class="timeline-modal-content" id="timelineModalContent">
    <div class="timeline-modal-header">
        <h3 class="timeline-modal-title" id="timelineModalTitle">28 июля 2010 (Альфа-мир)</h3>
        <button class="timeline-close-modal" id="timelineCloseModal">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <div class="timeline-modal-body">
        <div class="timeline-details" id="timelineModalBody">
            <!-- Контент будет загружаться динамически -->
        </div>
    </div>
</div>

<!-- Секция "Галерея" -->
<section id="gallery" class="gallery">
    <div class="container">
        <h2 class="section-title">Галерея</h2>
        <div class="gallery-grid">
            <div class="gallery-item">
                <img src="https://i.postimg.cc/rFhww55t/kurisu-6.jpg" alt="Официальный арт" class="gallery-img">
                <div class="gallery-caption">Официальный арт</div>
            </div>
            
            <div class="gallery-item">
                <img src="https://i.postimg.cc/RVC0mgJc/kurisu-2.png" alt="В Лаборатории Будущего" class="gallery-img">
                <div class="gallery-caption">В Лаборатории Будущего</div>
            </div>
            
            <div class="gallery-item">
                <img src="https://i.postimg.cc/HsWLm68c/kurisu-1.jpg" alt="С Окабэ Ринтаро" class="gallery-img">
                <div class="gallery-caption">С Окабэ Ринтаро</div>
            </div>
            
            <div class="gallery-item">
                <img src="https://i.postimg.cc/9FXf2Lwq/kurisu-3.jpg" alt="Научная работа" class="gallery-img">
                <div class="gallery-caption">Научная работа</div>
            </div>
            
            <div class="gallery-item">
                <img src="https://i.postimg.cc/YqXCCQQF/kurisu-5.jpg" alt="Цундере режим" class="gallery-img">
                <div class="gallery-caption">Цундере режим</div>
            </div>
            
            <div class="gallery-item">
                <img src="https://i.postimg.cc/5N9tJsQz/kurisu-4.jpg" alt="В Акихабаре" class="gallery-img">
                <div class="gallery-caption">В Акихабаре</div>
            </div>
        </div>
    </div>
</section>

<!-- Секция с плеером серий -->
<section id="episodes" class="episodes-section">
    <div class="container episodes-container">
        <h2 class="episodes-title">Первый сезон Врата Штейна</h2>
        
        <div class="episodes-content">
            <div class="episode-player-container">
                <div class="episode-player">
                    <div class="video-iframe-container">
                        <iframe 
                            id="videoFrame"
                            class="video-iframe"
                            src=""
                            allow="autoplay; encrypted-media; picture-in-picture"
                            allowfullscreen
                            frameborder="0">
                        </iframe>
                    </div>
                    <div class="video-loading" id="videoLoading">
                        <div class="loading-spinner">
                            <i class="fas fa-sync fa-spin"></i>
                        </div>
                        <p>Загрузка видео...</p>
                    </div>
                </div>
            </div>
            
            <div class="episodes-list">
                <h3 class="episodes-list-title">Список серий</h3>
                
                <!-- Серия 1 -->
                <div class="episode-item active" data-episode="1" data-video-id="1tiN_ly3Mh82I2zExRLLm83zNWeLZiMQN">
                    <div class="episode-number">01</div>
                    <div class="episode-name">Начало и конец</div>
                    <div class="episode-duration">24 мин</div>
                </div>
                
                <!-- Серия 2 -->
                <div class="episode-item" data-episode="2" data-video-id="1DS-G2352S51OHCTa5Ic2EcAc7A0dXsze">
                    <div class="episode-number">02</div>
                    <div class="episode-name">Параноидальный разрыв</div>
                    <div class="episode-duration">24 мин</div>
                </div>
                
                <!-- Серия 3 -->
                <div class="episode-item disabled" data-episode="3">
                    <div class="episode-number">03</div>
                    <div class="episode-name">Параллетический монетизм</div>
                    <div class="episode-duration">24 мин</div>
                </div>
                
                <!-- Серия 4 -->
                <div class="episode-item disabled" data-episode="4">
                    <div class="episode-number">04</div>
                    <div class="episode-name">Искривление интерпретации</div>
                    <div class="episode-duration">24 мин</div>
                </div>
                
                <!-- Серия 5 -->
                <div class="episode-item disabled" data-episode="5">
                    <div class="episode-number">05</div>
                    <div class="episode-name">Вектор столкновения</div>
                    <div class="episode-duration">24 мин</div>
                </div>
                
                <!-- Серия 6 -->
                <div class="episode-item disabled" data-episode="6">
                    <div class="episode-number">06</div>
                    <div class="episode-name">Дивергенция дивергенции</div>
                    <div class="episode-duration">24 мин</div>
                </div>
                
                <!-- Серия 7 -->
                <div class="episode-item disabled" data-episode="7">
                    <div class="episode-number">07</div>
                    <div class="episode-name">Трансцендентальное деление</div>
                    <div class="episode-duration">24 мин</div>
                </div>
            </div>
        </div>
        
        <!-- Раздел комментариев -->
        <div class="comments-section" id="commentsSection">
            <h3 class="comments-title">
                <i class="fas fa-comments"></i> Комментарии
            </h3>
            
            <!-- Форма для комментариев -->
            <div class="comment-form" id="commentForm">
                <h4 class="comment-form-title">
                    <i class="fas fa-edit"></i> Оставить комментарий
                </h4>
                <div class="comment-input-container">
                    <div class="comment-input-wrapper">
                        <textarea 
                            class="comment-textarea" 
                            id="commentText" 
                            placeholder="Напишите ваш комментарий..." 
                            maxlength="500"
                        ></textarea>
                        <div class="comment-form-actions">
                            <div class="comment-char-count" id="charCount">0/500</div>
                            <button type="button" class="comment-submit-btn" id="submitComment">
                                <i class="fas fa-paper-plane"></i> Отправить
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Список комментариев -->
            <div class="comments-list" id="commentsList">
                <!-- Комментарии будут загружаться сюда -->
            </div>
            
            <!-- Кнопка для открытия комментариев в модальном окне на мобильных -->
            <button class="open-comments-btn" id="openCommentsBtn">
                <i class="fas fa-comments"></i> Открыть все комментарии
            </button>
        </div>
    </div>
</section>

<!-- Футер -->
<footer>
    <div class="container">
        <div class="footer-content">
            <div class="lab-badge">Лаборатория Будущего №008</div>
            <p>Официальный сайт-визитка Макисэ Курису</p>
            <p>Исследования в области нейробиологии и временных технологий</p>
            <div class="el-psy-congroo">El Psy Congroo</div>
        </div>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script>
    // ===========================================
    // FIREBASE MANAGER CLASSES
    // ===========================================

    class FirebaseAuthManager {
        constructor() {
            this.auth = window.firebase.auth;
            this.authFunctions = window.firebase.authFunctions;
            this.db = window.firebase.db;
            this.firestore = window.firebase.firestoreFunctions;
            this.currentUser = null;
            this.initElements();
            this.bindEvents();
            this.checkAuthState();
        }
        
        initElements() {
            this.elements = {
                authButtons: document.getElementById('authButtons'),
                userInfo: document.getElementById('userInfo'),
                openLoginModal: document.getElementById('openLoginModal'),
                openRegisterModal: document.getElementById('openRegisterModal'),
                profileBtn: document.getElementById('profileBtn'),
                backToMainBtn: document.getElementById('backToMainBtn'),
                logoutBtn: document.getElementById('logoutBtn'),
                authModalOverlay: document.getElementById('authModalOverlay'),
                authModal: document.getElementById('authModal'),
                closeAuthModal: document.getElementById('closeAuthModal'),
                loginTabBtn: document.getElementById('loginTabBtn'),
                registerTabBtn: document.getElementById('registerTabBtn'),
                authModalTitle: document.getElementById('authModalTitle'),
                loginForm: document.getElementById('loginForm'),
                registerForm: document.getElementById('registerForm'),
                loginMessage: document.getElementById('loginMessage'),
                registerMessage: document.getElementById('registerMessage'),
                userAvatar: document.getElementById('userAvatar'),
                userName: document.getElementById('userName'),
                profilePage: document.getElementById('profilePage'),
                profileAvatarLarge: document.getElementById('profileAvatarLarge'),
                profileUserName: document.getElementById('profileUserName'),
                profileUserRole: document.getElementById('profileUserRole'),
                profileEmail: document.getElementById('profileEmail'),
                profileUsername: document.getElementById('profileUsername'),
                profileUserId: document.getElementById('profileUserId'),
                joinDate: document.getElementById('joinDate'),
                editProfileBtn: document.getElementById('editProfileBtn'),
                editProfileModalOverlay: document.getElementById('editProfileModalOverlay'),
                editProfileModal: document.getElementById('editProfileModal'),
                closeEditProfileModal: document.getElementById('closeEditProfileModal'),
                editProfileForm: document.getElementById('editProfileForm')
            };
        }
        
        bindEvents() {
            if (this.elements.openLoginModal) {
                this.elements.openLoginModal.addEventListener('click', () => this.openAuthModal('login'));
            }
            
            if (this.elements.openRegisterModal) {
                this.elements.openRegisterModal.addEventListener('click', () => this.openAuthModal('register'));
            }
            
            if (this.elements.closeAuthModal) {
                this.elements.closeAuthModal.addEventListener('click', () => this.closeAuthModal());
            }
            
            if (this.elements.authModalOverlay) {
                this.elements.authModalOverlay.addEventListener('click', () => this.closeAuthModal());
            }
            
            if (this.elements.loginTabBtn) {
                this.elements.loginTabBtn.addEventListener('click', () => this.switchTab('login'));
            }
            
            if (this.elements.registerTabBtn) {
                this.elements.registerTabBtn.addEventListener('click', () => this.switchTab('register'));
            }
            
            if (this.elements.loginForm) {
                this.elements.loginForm.addEventListener('submit', (e) => this.handleLogin(e));
            }
            
            if (this.elements.registerForm) {
                this.elements.registerForm.addEventListener('submit', (e) => this.handleRegister(e));
            }
            
            if (this.elements.profileBtn) {
                this.elements.profileBtn.addEventListener('click', () => this.showProfilePage());
            }
            
            if (this.elements.backToMainBtn) {
                this.elements.backToMainBtn.addEventListener('click', () => this.showMainPage());
            }
            
            if (this.elements.logoutBtn) {
                this.elements.logoutBtn.addEventListener('click', () => this.handleLogout());
            }
            
            if (this.elements.editProfileBtn) {
                this.elements.editProfileBtn.addEventListener('click', () => this.handleEditProfile());
            }
            
            if (this.elements.closeEditProfileModal) {
                this.elements.closeEditProfileModal.addEventListener('click', () => this.closeEditProfileModal());
            }
            
            if (this.elements.editProfileModalOverlay) {
                this.elements.editProfileModalOverlay.addEventListener('click', () => this.closeEditProfileModal());
            }
            
            if (this.elements.editProfileForm) {
                this.elements.editProfileForm.addEventListener('submit', (e) => this.handleEditProfileSubmit(e));
            }
            
            // Переключение видимости пароля
            document.querySelectorAll('.auth-toggle-password').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const targetId = e.target.closest('button').dataset.target;
                    const input = document.getElementById(targetId);
                    const icon = e.target.closest('button').querySelector('i');
                    
                    if (input && icon) {
                        if (input.type === 'password') {
                            input.type = 'text';
                            icon.classList.remove('fa-eye');
                            icon.classList.add('fa-eye-slash');
                        } else {
                            input.type = 'password';
                            icon.classList.remove('fa-eye-slash');
                            icon.classList.add('fa-eye');
                        }
                    }
                });
            });
        }
        
       checkAuthState() {
    console.log('Проверка состояния аутентификации...');
    
    this.authFunctions.onAuthStateChanged(this.auth, async (user) => {
        console.log('Состояние аутентификации изменилось:', user);
        
        if (user) {
            console.log('Пользователь вошел:', {
                uid: user.uid,
                email: user.email,
                displayName: user.displayName
            });
            
            this.currentUser = user;
            this.showUserInfo();
            
            // Загружаем профиль
            console.log('Загружаем профиль пользователя:', user.uid);
            await this.loadUserProfile(user.uid);
        } else {
            console.log('Пользователь вышел');
            this.currentUser = null;
            this.showAuthButtons();
        }
    });
}
        
       async loadUserProfile(userId) {
    try {
        const userDoc = await this.firestore.getDoc(
            this.firestore.doc(this.db, 'users', userId)
        );
        
        if (userDoc.exists()) {
            const userData = userDoc.data();
            this.updateUserInfo(userData);
        } else {
            // Создаем профиль пользователя в Firestore
            await this.createUserProfile(userId, this.currentUser);
        }
    } catch (error) {
        console.error('Ошибка загрузки профиля:', error);
    }
}

async createUserProfile(userId, firebaseUser) {
    try {
        console.log('Создание профиля для пользователя:', userId);
        
        const userData = {
            userId: userId,
            email: firebaseUser.email,
            username: firebaseUser.displayName || firebaseUser.email.split('@')[0],
            role: 'Участник Лаборатории',
            labId: `LAB-${String(Math.floor(Math.random() * 999) + 1).padStart(3, '0')}`,
            joinDate: new Date().toLocaleDateString('ru-RU'),
            avatar: '',
            commentCount: 0,
            createdAt: this.firestore.serverTimestamp(),
            displayName: firebaseUser.displayName || firebaseUser.email.split('@')[0]
        };
        
        // Создаем ссылку на документ
        const userDocRef = this.firestore.doc(this.db, 'users', userId);
        
        // Проверяем, существует ли уже документ
        const docSnap = await this.firestore.getDoc(userDocRef);
        
        if (docSnap.exists()) {
            console.log('Профиль уже существует, обновляем');
            await this.firestore.updateDoc(userDocRef, userData);
        } else {
            console.log('Создаем новый профиль');
            // Используем setDoc для создания нового документа
            await this.firestore.setDoc(userDocRef, userData);
        }
        
        this.updateUserInfo(userData);
        console.log('Профиль успешно создан/обновлен');
        return true;
    } catch (error) {
        console.error('Ошибка создания профиля:', error);
        
        // Попробуем альтернативный способ
        try {
            console.log('Пробуем альтернативный метод создания профиля...');
            
            const userData = {
                userId: userId,
                email: firebaseUser.email,
                username: firebaseUser.displayName || firebaseUser.email.split('@')[0],
                role: 'Участник Лаборатории',
                labId: `LAB-${String(Math.floor(Math.random() * 999) + 1).padStart(3, '0')}`,
                joinDate: new Date().toLocaleDateString('ru-RU'),
                avatar: '',
                commentCount: 0,
                createdAt: this.firestore.serverTimestamp(),
                displayName: firebaseUser.displayName || firebaseUser.email.split('@')[0]
            };
            
            // Создаем документ с автоматическим ID, но с указанием userId в данных
            const usersCollection = this.firestore.collection(this.db, 'users');
            await this.firestore.addDoc(usersCollection, userData);
            
            console.log('Профиль создан через addDoc');
            this.updateUserInfo(userData);
            return true;
        } catch (e) {
            console.error('Ошибка при попытке addDoc:', e);
            return false;
        }
    }
}
updateUserInfo(userData) {
    // Используем реальные данные из userData вместо жестких значений
    if (this.elements.userName) {
        this.elements.userName.textContent = userData.username || userData.displayName || 'Пользователь';
    }
    
    if (this.elements.profileUserName) {
        this.elements.profileUserName.textContent = userData.username || userData.displayName || 'Пользователь';
    }
    
    if (this.elements.profileUserRole) {
        this.elements.profileUserRole.textContent = userData.role || 'Участник Лаборатории';
    }
    
    if (this.elements.profileEmail) {
        this.elements.profileEmail.textContent = userData.email || this.currentUser.email || 'user@example.com';
    }
    
    if (this.elements.profileUsername) {
        this.elements.profileUsername.textContent = userData.username || userData.displayName || 'username';
    }
    
    if (this.elements.profileUserId) {
        this.elements.profileUserId.textContent = userData.labId ? userData.labId.split('-')[1] : '001';
    }
    
    if (this.elements.joinDate) {
        this.elements.joinDate.textContent = userData.joinDate || new Date().toLocaleDateString('ru-RU');
    }
    
    // Устанавливаем аватар
    const displayName = userData.username || userData.displayName || 'П';
    const firstLetter = displayName.charAt(0).toUpperCase();
    
    if (this.currentUser.photoURL) {
        if (this.elements.userAvatar) {
            this.elements.userAvatar.style.backgroundImage = `url(${this.currentUser.photoURL})`;
            this.elements.userAvatar.textContent = '';
        }
        if (this.elements.profileAvatarLarge) {
            this.elements.profileAvatarLarge.style.backgroundImage = `url(${this.currentUser.photoURL})`;
            this.elements.profileAvatarLarge.textContent = '';
        }
    } else {
        if (this.elements.userAvatar) {
            this.elements.userAvatar.style.backgroundImage = '';
            this.elements.userAvatar.textContent = firstLetter;
        }
        if (this.elements.profileAvatarLarge) {
            this.elements.profileAvatarLarge.style.backgroundImage = '';
            this.elements.profileAvatarLarge.textContent = firstLetter;
        }
    }
}
        
        showAuthButtons() {
            if (this.elements.authButtons) {
                this.elements.authButtons.style.display = 'flex';
            }
            if (this.elements.userInfo) {
                this.elements.userInfo.style.display = 'none';
            }
            this.showMainPage();
        }
        
        showUserInfo() {
            if (this.elements.authButtons) {
                this.elements.authButtons.style.display = 'none';
            }
            if (this.elements.userInfo) {
                this.elements.userInfo.style.display = 'flex';
            }
        }
        
        openAuthModal(tab = 'login') {
            if (this.elements.authModalOverlay) {
                this.elements.authModalOverlay.classList.add('active');
            }
            if (this.elements.authModal) {
                this.elements.authModal.classList.add('active');
            }
            document.body.style.overflow = 'hidden';
            this.switchTab(tab);
            
            if (tab === 'login') {
                const loginEmail = document.getElementById('loginEmail');
                if (loginEmail) loginEmail.focus();
            } else {
                const registerEmail = document.getElementById('registerEmail');
                if (registerEmail) registerEmail.focus();
            }
        }
        
        closeAuthModal() {
            if (this.elements.authModalOverlay) {
                this.elements.authModalOverlay.classList.remove('active');
            }
            if (this.elements.authModal) {
                this.elements.authModal.classList.remove('active');
            }
            document.body.style.overflow = '';
            this.clearMessages();
            
            if (this.elements.loginForm) {
                this.elements.loginForm.reset();
            }
            if (this.elements.registerForm) {
                this.elements.registerForm.reset();
            }
        }
        
        openEditProfileModal() {
            const editProfileName = document.getElementById('editProfileName');
            if (editProfileName) {
                editProfileName.value = this.currentUser.displayName || 
                    this.elements.profileUsername.textContent || 
                    '';
            }
            
            if (this.elements.editProfileModalOverlay) {
                this.elements.editProfileModalOverlay.classList.add('active');
            }
            if (this.elements.editProfileModal) {
                this.elements.editProfileModal.classList.add('active');
            }
            document.body.style.overflow = 'hidden';
        }
        
        closeEditProfileModal() {
            if (this.elements.editProfileModalOverlay) {
                this.elements.editProfileModalOverlay.classList.remove('active');
            }
            if (this.elements.editProfileModal) {
                this.elements.editProfileModal.classList.remove('active');
            }
            document.body.style.overflow = '';
        }
        
        switchTab(tab) {
            if (this.elements.loginTabBtn) {
                this.elements.loginTabBtn.classList.toggle('active', tab === 'login');
            }
            if (this.elements.registerTabBtn) {
                this.elements.registerTabBtn.classList.toggle('active', tab === 'register');
            }
            if (this.elements.authModalTitle) {
                this.elements.authModalTitle.textContent = tab === 'login' ? 'Вход' : 'Регистрация';
            }
            
            if (this.elements.loginForm) {
                this.elements.loginForm.classList.toggle('active', tab === 'login');
            }
            if (this.elements.registerForm) {
                this.elements.registerForm.classList.toggle('active', tab === 'register');
            }
            this.clearMessages();
        }
        
        async handleLogin(e) {
            e.preventDefault();
            this.clearMessages();
            
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                this.showMessage(this.elements.loginMessage, 'Заполните все поля', 'error');
                return;
            }
            
            try {
                const userCredential = await this.authFunctions.signInWithEmailAndPassword(
                    this.auth, email, password
                );
                
                this.showMessage(this.elements.loginMessage, 'Успешный вход!', 'success');
                
                setTimeout(() => {
                    this.closeAuthModal();
                    this.showMainPage();
                }, 1500);
            } catch (error) {
                let errorMessage = 'Ошибка входа';
                if (error.code === 'auth/user-not-found') {
                    errorMessage = 'Пользователь не найден';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = 'Неверный пароль';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Неверный формат email';
                }
                this.showMessage(this.elements.loginMessage, errorMessage, 'error');
            }
        }
        
        async handleRegister(e) {
    e.preventDefault();
    this.clearMessages();
    
    const email = document.getElementById('registerEmail').value.trim();
    const username = document.getElementById('registerUsername').value.trim();
    const password = document.getElementById('registerPassword').value;
    const confirmPassword = document.getElementById('registerConfirmPassword').value;
    const acceptTerms = document.getElementById('acceptTerms') ? document.getElementById('acceptTerms').checked : false;
    
    if (!email || !username || !password || !confirmPassword) {
        this.showMessage(this.elements.registerMessage, 'Заполните все поля', 'error');
        return;
    }
    
    if (!acceptTerms) {
        this.showMessage(this.elements.registerMessage, 'Необходимо принять условия использования', 'error');
        return;
    }
    
    if (password !== confirmPassword) {
        this.showMessage(this.elements.registerMessage, 'Пароли не совпадают', 'error');
        return;
    }
    
    if (password.length < 6) {
        this.showMessage(this.elements.registerMessage, 'Пароль должен содержать минимум 6 символов', 'error');
        return;
    }
    
    try {
        // Создаем пользователя в Firebase Auth
        const userCredential = await this.authFunctions.createUserWithEmailAndPassword(
            this.auth, email, password
        );
        
        // Обновляем отображаемое имя
        await this.authFunctions.updateProfile(userCredential.user, {
            displayName: username
        });
        
        // Сразу создаем профиль в Firestore
        await this.createUserProfile(userCredential.user.uid, userCredential.user);
        
        this.showMessage(this.elements.registerMessage, 'Регистрация успешна! Создаю профиль...', 'success');
        
        setTimeout(() => {
            this.showMessage(this.elements.registerMessage, 'Профиль создан! Перенаправляю...', 'success');
            
            setTimeout(() => {
                this.closeAuthModal();
                this.showMainPage();
            }, 1000);
        }, 1500);
    } catch (error) {
        let errorMessage = 'Ошибка регистрации';
        if (error.code === 'auth/email-already-in-use') {
            errorMessage = 'Пользователь с таким email уже существует';
        } else if (error.code === 'auth/invalid-email') {
            errorMessage = 'Неверный формат email';
        } else if (error.code === 'auth/weak-password') {
            errorMessage = 'Пароль слишком слабый';
        }
        this.showMessage(this.elements.registerMessage, errorMessage, 'error');
    }
}
        
        async handleLogout() {
            try {
                await this.authFunctions.signOut(this.auth);
                this.showAuthButtons();
                this.showMainPage();
            } catch (error) {
                console.error('Ошибка выхода:', error);
            }
        }
        
        handleEditProfile() {
            this.openEditProfileModal();
        }
        
        async handleEditProfileSubmit(e) {
            e.preventDefault();
            
            const newUsername = document.getElementById('editProfileName').value.trim();
            
            if (!newUsername) {
                alert('Пожалуйста, введите имя пользователя');
                return;
            }
            
            try {
                // Обновляем отображаемое имя в Firebase Auth
                await this.authFunctions.updateProfile(this.currentUser, {
                    displayName: newUsername
                });
                
                // Обновляем в Firestore
                await this.firestore.updateDoc(
                    this.firestore.doc(this.db, 'users', this.currentUser.uid),
                    {
                        username: newUsername
                    }
                );
                
                // Обновляем на странице
                if (this.elements.userName) {
                    this.elements.userName.textContent = newUsername;
                }
                if (this.elements.profileUserName) {
                    this.elements.profileUserName.textContent = newUsername;
                }
                if (this.elements.profileUsername) {
                    this.elements.profileUsername.textContent = newUsername;
                }
                
                // Обновляем аватар
                if (this.elements.userAvatar && !this.currentUser.photoURL) {
                    this.elements.userAvatar.textContent = newUsername.charAt(0).toUpperCase();
                }
                if (this.elements.profileAvatarLarge && !this.currentUser.photoURL) {
                    this.elements.profileAvatarLarge.textContent = newUsername.charAt(0).toUpperCase();
                }
                
                this.closeEditProfileModal();
                alert('Профиль успешно обновлен!');
            } catch (error) {
                console.error('Ошибка обновления профиля:', error);
                alert('Ошибка при обновлении профиля');
            }
        }
        
        showProfilePage() {
            const user = this.currentUser;
            if (!user) return;
            
            // Обновляем данные в профиле
            if (this.elements.profileAvatarLarge) {
                if (user.photoURL) {
                    this.elements.profileAvatarLarge.style.backgroundImage = `url(${user.photoURL})`;
                    this.elements.profileAvatarLarge.textContent = '';
                } else {
                    this.elements.profileAvatarLarge.style.backgroundImage = '';
                    this.elements.profileAvatarLarge.textContent = user.displayName ? 
                        user.displayName.charAt(0).toUpperCase() : 
                        user.email.charAt(0).toUpperCase();
                }
            }
            
            // Скрываем основное содержимое и показываем профиль
            document.querySelectorAll('section').forEach(section => {
                if (section) section.style.display = 'none';
            });
            
            const footer = document.querySelector('footer');
            if (footer) footer.style.display = 'none';
            
            if (this.elements.profilePage) {
                this.elements.profilePage.style.display = 'block';
            }
            
            window.scrollTo(0, 0);
        }
        
        showMainPage() {
            if (this.elements.profilePage) {
                this.elements.profilePage.style.display = 'none';
            }
            
            document.querySelectorAll('section').forEach(section => {
                if (section) section.style.display = 'block';
            });
            
            const footer = document.querySelector('footer');
            if (footer) footer.style.display = 'block';
            
            window.scrollTo(0, 0);
        }
        
        showMessage(element, text, type) {
            if (!element) return;
            
            element.textContent = text;
            element.className = `auth-message ${type} show`;
            
            if (type === 'success') {
                setTimeout(() => {
                    element.classList.remove('show');
                }, 5000);
            }
        }
        
        clearMessages() {
            if (this.elements.loginMessage) {
                this.elements.loginMessage.classList.remove('show');
            }
            if (this.elements.registerMessage) {
                this.elements.registerMessage.classList.remove('show');
            }
        }
    }

    class FirebaseCommentsManager {
        constructor(authManager) {
            this.authManager = authManager;
            this.db = window.firebase.db;
            this.firestore = window.firebase.firestoreFunctions;
            this.currentEpisodeId = 1;
            this.currentEpisodeName = 'Начало и конец';
            this.initElements();
            this.bindEvents();
            this.loadComments();
        }
        
        initElements() {
            this.elements = {
                commentForm: document.getElementById('commentForm'),
                commentText: document.getElementById('commentText'),
                charCount: document.getElementById('charCount'),
                submitComment: document.getElementById('submitComment'),
                commentsList: document.getElementById('commentsList'),
                commentsSection: document.getElementById('commentsSection'),
                modalCommentForm: document.getElementById('modalCommentForm'),
                modalCommentText: document.getElementById('modalCommentText'),
                modalCharCount: document.getElementById('modalCharCount'),
                modalSubmitComment: document.getElementById('modalSubmitComment'),
                modalCommentsList: document.getElementById('modalCommentsList'),
                openCommentsBtn: document.getElementById('openCommentsBtn'),
                commentsModalOverlay: document.getElementById('commentsModalOverlay'),
                commentsModal: document.getElementById('commentsModal'),
                commentsCloseModal: document.getElementById('commentsCloseModal')
            };
        }
        
        bindEvents() {
            if (this.elements.commentText) {
                this.elements.commentText.addEventListener('input', (e) => this.updateCharCount(e, this.elements.charCount));
            }
            
            if (this.elements.submitComment) {
                this.elements.submitComment.addEventListener('click', () => this.submitComment());
            }
            
            if (this.elements.modalCommentText) {
                this.elements.modalCommentText.addEventListener('input', (e) => this.updateCharCount(e, this.elements.modalCharCount));
            }
            
            if (this.elements.modalSubmitComment) {
                this.elements.modalSubmitComment.addEventListener('click', () => this.submitModalComment());
            }
            
            if (this.elements.openCommentsBtn) {
                this.elements.openCommentsBtn.addEventListener('click', () => this.openCommentsModal());
            }
            
            if (this.elements.commentsCloseModal) {
                this.elements.commentsCloseModal.addEventListener('click', () => this.closeCommentsModal());
            }
            
            if (this.elements.commentsModalOverlay) {
                this.elements.commentsModalOverlay.addEventListener('click', () => this.closeCommentsModal());
            }
            
            document.querySelectorAll('.episode-item').forEach(item => {
                item.addEventListener('click', () => {
                    if (!item.classList.contains('disabled')) {
                        const episodeId = parseInt(item.dataset.episode);
                        const episodeName = item.querySelector('.episode-name').textContent;
                        this.setCurrentEpisode(episodeId, episodeName);
                    }
                });
            });
        }
        
        setCurrentEpisode(episodeId, episodeName) {
            this.currentEpisodeId = episodeId;
            this.currentEpisodeName = episodeName;
            this.loadComments();
        }
        
        updateCharCount(e, charCountElement) {
            const text = e.target.value;
            const count = text.length;
            const maxLength = 500;
            
            if (charCountElement) {
                charCountElement.textContent = `${count}/${maxLength}`;
                
                if (count > maxLength * 0.9) {
                    charCountElement.classList.add('warning');
                    charCountElement.classList.remove('error');
                } else if (count > maxLength) {
                    charCountElement.classList.remove('warning');
                    charCountElement.classList.add('error');
                } else {
                    charCountElement.classList.remove('warning', 'error');
                }
            }
        }
        
        updateCommentForm() {
            const user = this.authManager.currentUser;
            const isLoggedIn = !!user;
            
            if (this.elements.commentForm) {
                if (isLoggedIn) {
                    this.elements.commentForm.style.display = 'block';
                } else {
                    this.elements.commentForm.style.display = 'none';
                }
            }
            
            if (this.elements.modalCommentForm) {
                if (isLoggedIn) {
                    this.elements.modalCommentForm.style.display = 'block';
                } else {
                    this.elements.modalCommentForm.style.display = 'none';
                }
            }
        }
        
        async loadComments() {
    try {
        // Показываем индикатор загрузки
        if (this.elements.commentsList) {
            this.elements.commentsList.innerHTML = `
                <div class="loading-comments">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Загрузка комментариев...</p>
                </div>
            `;
        }
        
        if (this.elements.modalCommentsList) {
            this.elements.modalCommentsList.innerHTML = `
                <div class="loading-comments">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Загрузка комментариев...</p>
                </div>
            `;
        }
        
        const commentsQuery = this.firestore.query(
            this.firestore.collection(this.db, 'comments'),
            this.firestore.where('episodeId', '==', this.currentEpisodeId),
            this.firestore.orderBy('createdAt', 'desc')
        );
        
        const querySnapshot = await this.firestore.getDocs(commentsQuery);
        
        // Очищаем список комментариев
        if (this.elements.commentsList) {
            this.elements.commentsList.innerHTML = '';
        }
        
        if (this.elements.modalCommentsList) {
            this.elements.modalCommentsList.innerHTML = '';
        }
        
        if (querySnapshot.empty) {
            const noCommentsHtml = `
                <div class="no-comments">
                    <i class="fas fa-comment-slash"></i>
                    <p>Пока нет комментариев.<br>Будьте первым, кто оставит отзыв!</p>
                </div>
            `;
            
            if (this.elements.commentsList) {
                this.elements.commentsList.innerHTML = noCommentsHtml;
            }
            
            if (this.elements.modalCommentsList) {
                this.elements.modalCommentsList.innerHTML = noCommentsHtml;
            }
            
            return;
        }
        
        // Загружаем данные пользователей для комментариев
        const commentsWithUserData = [];
        
        for (const doc of querySnapshot.docs) {
            const comment = doc.data();
            comment.id = doc.id;
            
            // Если createdAt не существует, создаем его
            if (!comment.createdAt) {
                comment.createdAt = new Date();
            }
            
            // Загружаем данные пользователя
            let userData = {};
            try {
                const userDoc = await this.firestore.getDoc(
                    this.firestore.doc(this.db, 'users', comment.userId)
                );
                if (userDoc.exists()) {
                    userData = userDoc.data();
                }
            } catch (error) {
                console.error('Ошибка загрузки данных пользователя:', error);
            }
            
            commentsWithUserData.push({
                ...comment,
                userName: userData.username || userData.displayName || 'Аноним',
                userRole: userData.role || 'Участник Лаборатории',
                userAvatar: userData.avatar || '',
                userDataLoaded: true
            });
        }
        
        // Отображаем комментарии
        commentsWithUserData.forEach(comment => {
            const commentHtml = this.createCommentHtml(comment);
            
            if (this.elements.commentsList) {
                this.elements.commentsList.insertAdjacentHTML('beforeend', commentHtml);
            }
            
            if (this.elements.modalCommentsList) {
                this.elements.modalCommentsList.insertAdjacentHTML('beforeend', commentHtml);
            }
            
            // Добавляем обработчик удаления
            setTimeout(() => {
                this.addDeleteHandler(comment.id, comment.userId);
            }, 100);
        });
    } catch (error) {
        console.error('Ошибка загрузки комментариев:', error);
        console.error('Детали ошибки:', error.code, error.message);
        
        const errorHtml = `
            <div class="no-comments">
                <i class="fas fa-exclamation-triangle"></i>
                <p>Ошибка загрузки комментариев</p>
                <p style="font-size: 0.8rem; margin-top: 10px;">Пожалуйста, проверьте подключение к Firebase</p>
            </div>
        `;
        
        if (this.elements.commentsList) {
            this.elements.commentsList.innerHTML = errorHtml;
        }
        
        if (this.elements.modalCommentsList) {
            this.elements.modalCommentsList.innerHTML = errorHtml;
        }
    }
}
        
        createCommentHtml(comment) {
            const date = comment.createdAt ? 
                comment.createdAt.toDate().toLocaleDateString('ru-RU', { 
                    day: 'numeric', 
                    month: 'long', 
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }) : 
                'Недавно';
            
            const avatarStyle = comment.userAvatar ? `background-image: url(${comment.userAvatar})` : '';
            const avatarContent = comment.userAvatar ? '' : comment.userName.charAt(0).toUpperCase();
            const currentUser = this.authManager.currentUser;
            const showDeleteBtn = currentUser && currentUser.uid === comment.userId;
            
            const deleteBtnHtml = showDeleteBtn 
                ? `<button class="comment-delete-btn" data-comment-id="${comment.id}" title="Удалить комментарий">
                    <i class="fas fa-trash"></i> Удалить
                   </button>` 
                : '';
            
            return `
                <div class="comment-item" data-comment-id="${comment.id}">
                    <div class="comment-header">
                        <div class="comment-author">
                            <div class="comment-author-avatar" style="${avatarStyle}">${avatarContent}</div>
                            <div class="comment-author-info">
                                <div class="comment-author-name">${comment.userName}</div>
                                <div class="comment-author-role">${comment.userRole}</div>
                            </div>
                        </div>
                        <div class="comment-date">${date}</div>
                    </div>
                    <div class="comment-content">${this.escapeHtml(comment.content)}</div>
                    <div class="comment-episode-info">
                        <div class="episode-text">
                            <i class="fas fa-play-circle"></i> Серия ${comment.episodeId}: ${comment.episodeName}
                        </div>
                        ${deleteBtnHtml}
                    </div>
                </div>
            `;
        }
        
        addDeleteHandler(commentId, userId) {
            const deleteBtns = document.querySelectorAll(`.comment-delete-btn[data-comment-id="${commentId}"]`);
            deleteBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.deleteComment(commentId, userId);
                });
            });
        }
        
        escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        async submitComment() {
            const user = this.authManager.currentUser;

            if (!user) {
                alert('Пожалуйста, войдите в аккаунт, чтобы оставлять комментарии');
                this.authManager.openAuthModal('login');
                return;
            }
            
            const commentText = this.elements.commentText ? this.elements.commentText.value.trim() : '';
            
            if (!commentText) {
                alert('Пожалуйста, введите текст комментария');
                return;
            }
            
            if (commentText.length > 500) {
                alert('Комментарий не должен превышать 500 символов');
                return;
            }
            
            try {
                // Загружаем данные пользователя
                let userData = {};
                const userDoc = await this.firestore.getDoc(
                    this.firestore.doc(this.db, 'users', user.uid)
                );
                if (userDoc.exists()) {
                    userData = userDoc.data();
                }
                
                const commentData = {
                    episodeId: this.currentEpisodeId,
                    userId: user.uid,
                    userName: userData.username || user.displayName || user.email.split('@')[0],
                    userRole: userData.role || 'Участник Лаборатории',
                    userAvatar: userData.avatar || '',
                    content: commentText,
                    episodeName: this.currentEpisodeName,
                    createdAt: this.firestore.serverTimestamp()
                };
                
                // Добавляем комментарий в Firestore
                const docRef = await this.firestore.addDoc(
                    this.firestore.collection(this.db, 'comments'),
                    commentData
                );
                
                // Обновляем счетчик комментариев пользователя
                await this.firestore.updateDoc(
                    this.firestore.doc(this.db, 'users', user.uid),
                    {
                        commentCount: (userData.commentCount || 0) + 1
                    }
                );
                
                // Очищаем поле ввода
                if (this.elements.commentText) {
                    this.elements.commentText.value = '';
                    this.updateCharCount({ target: this.elements.commentText }, this.elements.charCount);
                }
                
                // Добавляем комментарий с временным ID
                commentData.id = docRef.id;
                commentData.createdAt = new Date();
                
                const commentHtml = this.createCommentHtml(commentData);
                
                // Убираем сообщение об отсутствии комментариев
                const noCommentsElement = this.elements.commentsList.querySelector('.no-comments');
                if (noCommentsElement) {
                    noCommentsElement.remove();
                }
                
                const modalNoCommentsElement = this.elements.modalCommentsList ? this.elements.modalCommentsList.querySelector('.no-comments') : null;
                if (modalNoCommentsElement) {
                    modalNoCommentsElement.remove();
                }
                
                // Добавляем комментарий
                if (this.elements.commentsList) {
                    this.elements.commentsList.insertAdjacentHTML('afterbegin', commentHtml);
                }
                
                if (this.elements.modalCommentsList) {
                    this.elements.modalCommentsList.insertAdjacentHTML('afterbegin', commentHtml);
                }
                
                // Добавляем обработчик удаления
                this.addDeleteHandler(docRef.id, user.uid);
                
                // Показываем уведомление
                this.showNotification('Комментарий успешно добавлен!', 'success');
            } catch (error) {
                console.error('Ошибка добавления комментария:', error);
                this.showNotification('Ошибка при добавлении комментария', 'error');
            }
        }
        
        async submitModalComment() {
            const user = this.authManager.currentUser;
            if (!user) {
                alert('Пожалуйста, войдите в аккаунт, чтобы оставлять комментарии');
                this.authManager.openAuthModal('login');
                return;
            }
            
            const commentText = this.elements.modalCommentText ? this.elements.modalCommentText.value.trim() : '';
            
            if (!commentText) {
                alert('Пожалуйста, введите текст комментария');
                return;
            }
            
            if (commentText.length > 500) {
                alert('Комментарий не должен превышать 500 символов');
                return;
            }
            
            try {
                // Загружаем данные пользователя
                let userData = {};
                const userDoc = await this.firestore.getDoc(
                    this.firestore.doc(this.db, 'users', user.uid)
                );
                if (userDoc.exists()) {
                    userData = userDoc.data();
                }
                
                const commentData = {
                    episodeId: this.currentEpisodeId,
                    userId: user.uid,
                    userName: userData.username || user.displayName || user.email.split('@')[0],
                    userRole: userData.role || 'Участник Лаборатории',
                    userAvatar: userData.avatar || '',
                    content: commentText,
                    episodeName: this.currentEpisodeName,
                    createdAt: this.firestore.serverTimestamp()
                };
                
                // Добавляем комментарий в Firestore
                const docRef = await this.firestore.addDoc(
                    this.firestore.collection(this.db, 'comments'),
                    commentData
                );
                
                // Обновляем счетчик комментариев пользователя
                await this.firestore.updateDoc(
                    this.firestore.doc(this.db, 'users', user.uid),
                    {
                        commentCount: (userData.commentCount || 0) + 1
                    }
                );
                
                // Очищаем поле ввода
                if (this.elements.modalCommentText) {
                    this.elements.modalCommentText.value = '';
                    this.updateCharCount({ target: this.elements.modalCommentText }, this.elements.modalCharCount);
                }
                
                // Добавляем комментарий с временным ID
                commentData.id = docRef.id;
                commentData.createdAt = new Date();
                
                const commentHtml = this.createCommentHtml(commentData);
                
                // Убираем сообщение об отсутствии комментариев
                const noCommentsElement = this.elements.commentsList ? this.elements.commentsList.querySelector('.no-comments') : null;
                if (noCommentsElement) {
                    noCommentsElement.remove();
                }
                
                const modalNoCommentsElement = this.elements.modalCommentsList.querySelector('.no-comments');
                if (modalNoCommentsElement) {
                    modalNoCommentsElement.remove();
                }
                
                // Добавляем комментарий
                if (this.elements.commentsList) {
                    this.elements.commentsList.insertAdjacentHTML('afterbegin', commentHtml);
                }
                
                if (this.elements.modalCommentsList) {
                    this.elements.modalCommentsList.insertAdjacentHTML('afterbegin', commentHtml);
                }
                
                // Добавляем обработчик удаления
                this.addDeleteHandler(docRef.id, user.uid);
                
                // Показываем уведомление
                this.showNotification('Комментарий успешно добавлен!', 'success');
            } catch (error) {
                console.error('Ошибка добавления комментария:', error);
                this.showNotification('Ошибка при добавлении комментария', 'error');
            }
        }
        
        async deleteComment(commentId, userId) {
            const user = this.authManager.currentUser;
            if (!user || user.uid !== userId) return;
            
            if (!confirm('Вы уверены, что хотите удалить этот комментарий?')) {
                return;
            }
            
            try {
                await this.firestore.deleteDoc(
                    this.firestore.doc(this.db, 'comments', commentId)
                );
                
                // Уменьшаем счетчик комментариев пользователя
                const userDoc = await this.firestore.getDoc(
                    this.firestore.doc(this.db, 'users', user.uid)
                );
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    await this.firestore.updateDoc(
                        this.firestore.doc(this.db, 'users', user.uid),
                        {
                            commentCount: Math.max(0, (userData.commentCount || 1) - 1)
                        }
                    );
                }
                
                // Удаляем комментарий из DOM
                const commentElements = document.querySelectorAll(`[data-comment-id="${commentId}"]`);
                commentElements.forEach(commentElement => {
                    if (commentElement) {
                        commentElement.style.animation = 'fadeOut 0.3s ease';
                        commentElement.style.opacity = '0';
                        
                        setTimeout(() => {
                            if (commentElement.parentNode) {
                                commentElement.parentNode.removeChild(commentElement);
                            }
                        }, 300);
                    }
                });
                
                // Проверяем, остались ли комментарии
                const commentsQuery = this.firestore.query(
                    this.firestore.collection(this.db, 'comments'),
                    this.firestore.where('episodeId', '==', this.currentEpisodeId)
                );
                
                const querySnapshot = await this.firestore.getDocs(commentsQuery);
                
                if (querySnapshot.empty) {
                    const noCommentsHtml = `
                        <div class="no-comments">
                            <i class="fas fa-comment-slash"></i>
                            <p>Пока нет комментариев.<br>Будьте первым, кто оставит отзыв!</p>
                        </div>
                    `;
                    
                    if (this.elements.commentsList && this.elements.commentsList.children.length === 0) {
                        this.elements.commentsList.innerHTML = noCommentsHtml;
                    }
                    
                    if (this.elements.modalCommentsList && this.elements.modalCommentsList.children.length === 0) {
                        this.elements.modalCommentsList.innerHTML = noCommentsHtml;
                    }
                }
                
                this.showNotification('Комментарий удален!', 'success');
            } catch (error) {
                console.error('Ошибка удаления комментария:', error);
                this.showNotification('Ошибка при удалении комментария', 'error');
            }
        }
        
        openCommentsModal() {
            this.loadComments();
            
            if (this.elements.commentsModalOverlay) {
                this.elements.commentsModalOverlay.classList.add('active');
            }
            
            if (this.elements.commentsModal) {
                this.elements.commentsModal.classList.add('active');
            }
            
            document.body.style.overflow = 'hidden';
        }
        
        closeCommentsModal() {
            if (this.elements.commentsModalOverlay) {
                this.elements.commentsModalOverlay.classList.remove('active');
            }
            
            if (this.elements.commentsModal) {
                this.elements.commentsModal.classList.remove('active');
            }
            
            document.body.style.overflow = '';
        }
        
        showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `auth-message ${type} show`;
            notification.textContent = message;
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.right = '20px';
            notification.style.zIndex = '10004';
            notification.style.maxWidth = '300px';
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
    }

    // ===========================================
    // ОСНОВНОЙ КОД САЙТА
    // ===========================================

    // Инициализация частиц для фона
    particlesJS('particles-js', {
        particles: {
            number: { value: 80, density: { enable: true, value_area: 800 } },
            color: { value: "#c62828" },
            shape: { type: "circle" },
            opacity: { value: 0.5, random: true },
            size: { value: 3, random: true },
            line_linked: {
                enable: true,
                distance: 150,
                color: "#1a237e",
                opacity: 0.4,
                width: 1
            },
            move: {
                enable: true,
                speed: 2,
                direction: "none",
                random: true,
                straight: false,
                out_mode: "out",
                bounce: false
            }
        },
        interactivity: {
            detect_on: "canvas",
            events: {
                onhover: { enable: true, mode: "repulse" },
                onclick: { enable: true, mode: "push" }
            }
        }
    });
    
    // Плавная прокрутка для навигации
    document.querySelectorAll('nav a').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href');
            const targetElement = document.querySelector(targetId);
            
            if (targetElement) {
                window.scrollTo({
                    top: targetElement.offsetTop - 80,
                    behavior: 'smooth'
                });
            }
        });
    });
    
    // Бинарный фон
    const binaryBg = document.getElementById('binaryBg');
    const chars = '01';
    const worldLines = [];
    
    for (let i = 0; i < 50; i++) {
        const worldLine = document.createElement('div');
        worldLine.className = 'world-line';
        worldLine.style.left = Math.random() * 100 + 'vw';
        worldLine.style.top = Math.random() * 100 + 'vh';
        worldLine.textContent = 'МИРОВАЯ ЛИНИЯ ' + Math.floor(Math.random() * 1000000);
        worldLine.style.opacity = Math.random() * 0.5 + 0.1;
        binaryBg.appendChild(worldLine);
        worldLines.push(worldLine);
    }
    
    // Анимация мировых линий
    function animateWorldLines() {
        worldLines.forEach(line => {
            line.style.top = (parseFloat(line.style.top) + 0.1) + 'vh';
            if (parseFloat(line.style.top) > 100) {
                line.style.top = '-10vh';
                line.style.left = Math.random() * 100 + 'vw';
            }
        });
        requestAnimationFrame(animateWorldLines);
    }
    
    animateWorldLines();
    
    // ===========================================
    // ДАННЫЕ ДЛЯ ВСЕХ СЕКЦИЙ
    // ===========================================

    // Данные для научных достижений
    const tabData = {
        'memory-jump': {
            title: 'Машина скачков по памяти',
            content: `
                <div class="achievement-details">
                    <p class="achievement-description">
                        Инновационное устройство, позволяющее передавать воспоминания из настоящего в прошлое, 
                        фактически осуществляя ограниченное путешествие во времени через сознание человека.
                    </p>
                    <ul class="achievement-features">
                        <li>Использует принцип квантовой телепортации сознания</li>
                        <li>Работает через систему LHC (отправка данных в прошлое)</li>
                        <li>Модифицирована из микроволновой печи с добавлением неон-лазерных диодов</li>
                        <li>Требует точных временных координат и волновых функций мозга</li>
                        <li>Создана в сотрудничестве с Окабэ Ринтаро и лабораторией будущего</li>
                    </ul>
                </div>
                <div class="achievement-visual">
                    <img src="https://i.postimg.cc/YqXCCQQD/Schematic-representation-of-the-device.webp" alt="Схематическое изображение устройства">
                    <div class="visual-label">Схематическое изображение устройства</div>
                </div>
            `
        },
        'neuro-research': {
            title: 'Нейробиологические исследования',
            content: `
                <div class="achievement-details">
                    <p class="achievement-description">
                        Прорывные исследования в области нейропластичности и кодирования памяти, 
                        заложившие теоретическую основу для технологии скачков по памяти.
                    </p>
                    <ul class="achievement-features">
                        <li>Открытие механизма "временной волны" в гиппокампе</li>
                        <li>Исследование нейронных коррелятов дежавю</li>
                        <li>Разработка модели квантового кодирования воспоминаний</li>
                        <li>Теория о существовании "хронологических нейронов"</li>
                        <li>Эксперименты по стиранию и восстановлению памяти</li>
                    </ul>
                </div>
                <div class="achievement-visual">
                    <img src="https://i.postimg.cc/zXdGGTTj/Map-of-the-hippocampus-neural-connections.jpg" alt="Карта нейронных связей гиппокампа">
                    <div class="visual-label">Карта нейронных связей гиппокампа</div>
                </div>
            `
        },
        'time-travel': {
            title: 'Теория путешествий во времени',
            content: `
                <div class="achievement-details">
                    <p class="achievement-description">
                        Революционная теория, объединяющая квантовую механику с концепцией мировых линий, 
                        объясняющая парадоксы временных путешествий и предлагающая практическую реализацию.
                    </p>
                    <ul class="achievement-features">
                        <li>Концепция "Притяжения мировой линии" (World Line Attraction Field)</li>
                        <li>Теория конвергенции мировых линий в точках дивергенции</li>
                        <li>Математическое описание временных парадоксов и их разрешений</li>
                        <li>Модель квантового туннелирования через временные барьеры</li>
                        <li>Практическая реализация через отправку D-mail (D-писем)</li>
                    </ul>
                </div>
                <div class="achievement-visual">
                    <img src="https://i.postimg.cc/Dyfzhx48/Diagram-of-world-lines-and-time-branches.jpg" alt="Диаграмма мировых линий и временных разветвлений">
                    <div class="visual-label">Диаграмма мировых линий и временных разветвлений</div>
                </div>
            `
        },
        'publications': {
            title: 'Научные публикации',
            content: `
                <div class="achievement-details">
                    <p class="achievement-description">
                        Несмотря на молодой возраст, Макисэ Курису опубликовала несколько важных научных работ, 
                        получивших международное признание в академических кругах.
                    </p>
                    <ul class="achievement-features">
                        <li>"Квантовая природа памяти: Нейронные основы временного кодирования" (Science, 2009)</li>
                        <li>"Возможность манипуляции мировыми линиями через квантовые возмущения" (Nature Physics, 2010)</li>
                        <li>"Экспериментальное подтверждение существования Reading Steiner" (PNAS, 2010)</li>
                        <li>"Практическая реализация ограниченного временного путешествия через LHC" (Cell, 2011)</li>
                        <li>"Машина скачков по памяти: от теории к практике" (совместно с Окабэ Р., 2011)</li>
                    </ul>
                </div>
                <div class="achievement-visual">
                    <img src="https://i.postimg.cc/TY2Pxt5K/Covers-of-scientific-journals-with-Kurisu-s-publications.jpg" alt="Обложки научных журналов с публикациями Курису">
                    <div class="visual-label">Обложки научных журналов с публикациями Курису</div>
                </div>
            `
        }
    };

    // Данные для временной линии
    const timelineEvents = {
        'event1': {
            title: '28 июля 2010 (Альфа-мир)',
            content: `
                <div class="timeline-description">
                    <p class="timeline-full-description">
                        Судьбоносная встреча Макисэ Курису с Окабэ Ринтаро в лекционном зале Радиокан. 
                        Курису прибыла в Японию для выступления на научной конференции, где представляла свои 
                        исследования в области нейробиологии. В этот же день происходит первое столкновение 
                        с парадоксами времени.
                    </p>
                    <p class="timeline-full-description">
                        Курису становится невольной свидетельницей отправки первого D-mail (D-письма) - 
                        сообщения в прошлое, которое изменяет мировую линию. Это событие запускает цепь 
                        временных экспериментов и приводит к созданию Лаборатории Будущего.
                    </p>
                    <ul class="timeline-features">
                        <li>Первая встреча Курису и Окабэ в лекционном зале</li>
                        <li>Отправка первого D-mail (сообщение о поимке майора)</li>
                        <li>Смена мировой линии с Beta на Alpha</li>
                        <li>Начало временных экспериментов</li>
                        <li>Обнаружение феномена Reading Steiner у Окабэ</li>
                    </ul>
                </div>
                <div class="timeline-visual">
                    <img src="https://i.postimg.cc/8PyzzLLh/Radiokan-Lecture-Hall-the-place-of-the-first-meeting.webp" alt="Лекционный зал Радиокан">
                    <div class="timeline-visual-label">Лекционный зал Радиокан, место первой встречи</div>
                </div>
            `
        },
        'event2': {
            title: 'Июль-Август 2010',
            content: `
                <div class="timeline-description">
                    <p class="timeline-full-description">
                        Курису официально присоединяется к Лаборатории Будущего в роли главного научного 
                        консультанта. Её экспертиза в области нейробиологии становится ключевой для понимания 
                        механизмов временных путешествий.
                    </p>
                    <p class="timeline-full-description">
                        Совместно с членами лаборатории, Курису помогает усовершенствовать обычную микроволновую 
                        печь ("Микроволновка Банано") в полноценную машину времени. Она разрабатывает теорию 
                        мировых линий и начинает работу над "Машиной скачков по памяти".
                    </p>
                    <ul class="timeline-features">
                        <li>Официальное вступление в Лабораторию Будущего</li>
                        <li>Модификация микроволновки в машину времени</li>
                        <li>Разработка теории мировых линий</li>
                        <li>Начало работы над Memory Leap Machine</li>
                        <li>Установление связи с SERN</li>
                    </ul>
                </div>
                <div class="timeline-visual">
                    <img src="https://i.postimg.cc/hPCttVVY/The-Future-Laboratory-a-place-for-experiments.jpg" alt="Лаборатория Будущего">
                    <div class="timeline-visual-label">Лаборатория Будущего, место проведения экспериментов</div>
                </div>
            `
        },
        'event3': {
            title: 'Август 2010 (Альфа-мир)',
            content: `
                <div class="timeline-description">
                    <p class="timeline-full-description">
                        Курису завершает разработку "Машины скачков по памяти" - революционного устройства, 
                        позволяющего передавать воспоминания из настоящего в прошлое. Эта технология становится 
                        ключевым инструментом для спасения Маюри Сиины от неизбежной гибели.
                    </p>
                    <p class="timeline-full-description">
                        Вместе с Окабэ, Курису проводит серию опасных экспериментов по изменению мировой линии, 
                        пытаясь найти путь к Мировой линии Врат Штейна - идеальной временной линии, где все главные герои 
                        остаются живы и счастливы.
                    </p>
                    <ul class="timeline-features">
                        <li>Завершение разработки Memory Leap Machine</li>
                        <li>Попытки спасения Маюри от Convergence</li>
                        <li>Открытие принципа Attractor Field</li>
                        <li>Эксперименты с Reading Steiner</li>
                        <li>Обнаружение временных парадоксов</li>
                    </ul>
                </div>
                <div class="timeline-visual">
                    <img src="https://i.postimg.cc/9FxQQyyx/Schematic-representation-of-the-Memory-Leap-Machine.jpg" alt="Машина скачков по памяти">
                    <div class="timeline-visual-label">Схематическое изображение Memory Leap Machine</div>
                </div>
            `
        },
        'event4': {
            title: 'Конец Августа 2010',
            content: `
                <div class="timeline-description">
                    <p class="timeline-full-description">
                        В кульминационный момент временного противостояния, Курису жертвует собой в 
                        Альфа-мире, чтобы Окабэ мог достичь Мировой линии Врат Штейна. Её смерть становится необходимым 
                        условием для изменения мировой линии и спасения всех остальных.
                    </p>
                    <p class="timeline-full-description">
                        Это самопожертвование демонстрирует глубину чувств Курису к Окабэ и её готовность 
                        пожертвовать собой ради достижения лучшего будущего. Её смерть оставляет глубокий 
                        след в сознании Окабэ и становится движущей силой для его дальнейших действий.
                    </p>
                    <ul class="timeline-features">
                        <li>Самопожертвование Курису в Альфа-мире</li>
                        <li>Переход в Beta мировую линию</li>
                        <li>Начало операции по достижению Мировой линии Врат Штейна</li>
                        <li>Воспоминания Окабэ о "мертвой" Курису</li>
                        <li>Подготовка к финальной временной операции</li>
                    </ul>
                </div>
                <div class="timeline-visual">
                    <img src="https://i.postimg.cc/BQZv3mPv/A-tragic-moment-of-self-sacrifice.jpg" alt="Трагический момент">
                    <div class="timeline-visual-label">Трагический момент самопожертвования</div>
                </div>
            `
        },
        'event5': {
            title: 'Мир Врат Штейна',
            content: `
                <div class="timeline-description">
                    <p class="timeline-full-description">
                        После успешного достижения Мировой линии Врат Штейна, Курису воссоединяется с 
                        Окабэ в идеальном мире, где оба спасены от своих трагических судеб. В этой линии 
                        времени Курису никогда не была убита, а Окабэ сохранил воспоминания о всех 
                        предыдущих мировых линиях.
                    </p>
                    <p class="timeline-full-description">
                        Курису продолжает свои научные исследования в области нейробиологии, теперь с 
                        практическим опытом временных путешествий. Её отношения с Окабэ развиваются, и 
                        вместе они продолжают работать над новыми научными открытиями в мирных условиях.
                    </p>
                    <ul class="timeline-features">
                        <li>Воссоединение Курису и Окабэ в Мире Врат Штейна</li>
                        <li>Сохранение воспоминаний о всех мировых линиях</li>
                        <li>Продолжение научных исследований</li>
                        <li>Развитие отношений между персонажами</li>
                        <li>Мирная жизнь без временных угроз</li>
                    </ul>
                </div>
                <div class="timeline-visual">
                    <img src="https://i.postimg.cc/c4DLLff2/The-ideal-peaceful-line-of-the-Stein-Gate.jpg" alt="Мир Врат Штейна">
                    <div class="timeline-visual-label">Идеальная мирная линия Врат Штейна</div>
                </div>
            `
        }
    };

    // ===========================================
    // ОСНОВНОЙ КОД
    // ===========================================
    
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Сайт Макисэ Курису загружен!');
        
        // Проверяем, что Firebase инициализирован
        if (!window.firebase || !window.firebase.auth) {
            console.error('Firebase не инициализирован!');
            alert('Ошибка инициализации Firebase. Пожалуйста, обновите страницу.');
            return;
        }
        
        // Инициализация Firebase менеджеров
        const firebaseAuthManager = new FirebaseAuthManager();
        const firebaseCommentsManager = new FirebaseCommentsManager(firebaseAuthManager);
        
        // Обновляем форму комментариев при изменении состояния авторизации
        firebaseAuthManager.authFunctions.onAuthStateChanged(firebaseAuthManager.auth, (user) => {
            firebaseCommentsManager.updateCommentForm();
        });
        
        // ===========================================
        // 1. НАУЧНЫЕ ДОСТИЖЕНИЯ
        // ===========================================
        const tabButtons = document.querySelectorAll('.tab-btn');
        const modalOverlay = document.getElementById('modalOverlay');
        const modalContent = document.getElementById('modalContent');
        const modalTitle = document.getElementById('modalTitle');
        const modalBody = document.getElementById('modalBody');
        const closeModal = document.getElementById('closeModal');
        
        function openModal(tabId) {
            const data = tabData[tabId];
            if (!data) return;
            
            modalTitle.textContent = data.title;
            modalBody.innerHTML = data.content;
            
            document.body.style.overflow = 'hidden';
            modalOverlay.classList.add('active');
            modalContent.classList.add('active');
            
            const activeButton = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
            if (activeButton) {
                activeButton.style.animation = 'buttonPress 0.4s ease';
                setTimeout(() => {
                    activeButton.style.animation = '';
                }, 400);
                
                tabButtons.forEach(btn => btn.classList.remove('active'));
                activeButton.classList.add('active');
            }
        }
        
        function closeModalWindow() {
            document.body.style.overflow = '';
            modalOverlay.classList.remove('active');
            modalContent.classList.remove('active');
        }
        
        tabButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                openModal(tabId);
            });
        });
        
        closeModal.addEventListener('click', closeModalWindow);
        modalOverlay.addEventListener('click', closeModalWindow);
        
        // ===========================================
        // 2. ВРЕМЕННАЯ ЛИНИЯ
        // ===========================================
        const timelineButtons = document.querySelectorAll('.timeline-btn');
        const timelineModalOverlay = document.getElementById('timelineModalOverlay');
        const timelineModalContent = document.getElementById('timelineModalContent');
        const timelineModalTitle = document.getElementById('timelineModalTitle');
        const timelineModalBody = document.getElementById('timelineModalBody');
        const timelineCloseModal = document.getElementById('timelineCloseModal');
        
        function openTimelineModal(eventId) {
            const eventData = timelineEvents[eventId];
            if (!eventData) return;
            
            timelineModalTitle.textContent = eventData.title;
            timelineModalBody.innerHTML = eventData.content;
            
            document.body.style.overflow = 'hidden';
            timelineModalOverlay.classList.add('active');
            timelineModalContent.classList.add('active');
            
            const activeButton = document.querySelector(`.timeline-btn[data-event="${eventId}"]`);
            if (activeButton) {
                activeButton.style.animation = 'buttonPress 0.4s ease';
                setTimeout(() => {
                    activeButton.style.animation = '';
                }, 400);
            }
        }
        
        function closeTimelineModal() {
            document.body.style.overflow = '';
            timelineModalOverlay.classList.remove('active');
            timelineModalContent.classList.remove('active');
        }
        
        timelineButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                const eventId = this.getAttribute('data-event');
                openTimelineModal(eventId);
            });
        });
        
        timelineCloseModal.addEventListener('click', closeTimelineModal);
        timelineModalOverlay.addEventListener('click', closeTimelineModal);
        
        // ===========================================
        // 3. ПЛЕЕР СЕРИЙ
        // ===========================================
        const episodeItems = document.querySelectorAll('.episode-item:not(.disabled)');
        const videoFrame = document.getElementById('videoFrame');
        const videoLoading = document.getElementById('videoLoading');
        
        function getGoogleDriveVideoUrl(fileId) {
            return `https://drive.google.com/file/d/${fileId}/preview`;
        }
        
        function showLoading() {
            if (videoLoading) {
                videoLoading.style.display = 'flex';
            }
            if (videoFrame) {
                videoFrame.style.opacity = '0.5';
            }
        }
        
        function hideLoading() {
            if (videoLoading) {
                videoLoading.style.display = 'none';
            }
            if (videoFrame) {
                videoFrame.style.opacity = '1';
            }
        }
        
        // Загружаем первую серию
        const firstEpisode = document.querySelector('.episode-item.active');
        if (firstEpisode && videoFrame) {
            const firstVideoId = firstEpisode.getAttribute('data-video-id');
            if (firstVideoId) {
                showLoading();
                videoFrame.src = getGoogleDriveVideoUrl(firstVideoId);
                
                videoFrame.onload = function() {
                    setTimeout(hideLoading, 1000);
                };
                
                setTimeout(hideLoading, 5000);
            }
        }
        
        // Переключение серий
        episodeItems.forEach(item => {
            item.addEventListener('click', function() {
                if (this.classList.contains('disabled')) return;
                
                const videoId = this.getAttribute('data-video-id');
                const episodeId = parseInt(this.getAttribute('data-episode'));
                const episodeName = this.querySelector('.episode-name').textContent;
                
                episodeItems.forEach(item => item.classList.remove('active'));
                this.classList.add('active');
                
                if (videoId && videoFrame) {
                    showLoading();
                    videoFrame.src = getGoogleDriveVideoUrl(videoId);
                    
                    videoFrame.onload = function() {
                        setTimeout(hideLoading, 1000);
                    };
                    
                    setTimeout(hideLoading, 5000);
                }
                
                // Обновляем комментарии для выбранной серии
                if (firebaseCommentsManager) {
                    firebaseCommentsManager.setCurrentEpisode(episodeId, episodeName);
                }
                
                if (window.innerWidth < 768) {
                    document.getElementById('episodes').scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
        
        // ===========================================
        // 4. АНИМАЦИИ И ЭФФЕКТЫ
        // ===========================================
        
        // Анимация появления элементов
        const animateOnScroll = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, { threshold: 0.1 });
        
        // Анимируем элементы временной линии
        const timelineItems = document.querySelectorAll('.timeline-item');
        timelineItems.forEach((item, index) => {
            animateOnScroll.observe(item);
            
            setTimeout(() => {
                item.style.opacity = '1';
                item.style.transform = 'translateY(0)';
                item.style.transition = 'opacity 0.8s ease, transform 0.8s ease';
            }, 300 + (index * 200));
        });
        
        // Анимация кнопок достижений
        tabButtons.forEach((btn, index) => {
            btn.style.opacity = '0';
            btn.style.transform = 'translateY(30px)';
            
            setTimeout(() => {
                btn.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                btn.style.opacity = '1';
                btn.style.transform = 'translateY(0)';
            }, 200 + (index * 100));
        });
        
        // Анимация карточек галереи
        const galleryItems = document.querySelectorAll('.gallery-item');
        galleryItems.forEach((item, index) => {
            item.style.opacity = '0';
            item.style.transform = 'scale(0.9)';
            
            setTimeout(() => {
                item.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                item.style.opacity = '1';
                item.style.transform = 'scale(1)';
            }, 300 + (index * 100));
        });
        
        // ===========================================
        // 5. ОБРАБОТКА КЛАВИШ
        // ===========================================
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                if (timelineModalOverlay.classList.contains('active')) {
                    closeTimelineModal();
                } else if (modalOverlay.classList.contains('active')) {
                    closeModalWindow();
                } else if (document.querySelector('.auth-modal-overlay.active')) {
                    firebaseAuthManager.closeAuthModal();
                } else if (document.querySelector('.comments-modal-overlay.active')) {
                    firebaseCommentsManager.closeCommentsModal();
                } else if (document.querySelector('.edit-profile-modal.active')) {
                    firebaseAuthManager.closeEditProfileModal();
                }
            }
        });
        
        // ===========================================
        // 6. АНИМАЦИЯ КАПЕЛЬ ДЛЯ ВРЕМЕННОЙ ЛИНИИ
        // ===========================================
        const canvas = document.getElementById('raindrop-canvas');
        if (canvas) {
            const ctx = canvas.getContext('2d');
            let w = canvas.width = window.innerWidth;
            let h = canvas.height = window.innerHeight;
            const clearColor = 'rgba(10, 10, 18, 0.05)';
            const max = 35;
            const drops = [];

            function random(min, max) {
                return Math.random() * (max - min) + min;
            }

            function Raindrop() {}

            Raindrop.prototype = {
                init: function() {
                    this.x = random(0, w);
                    this.y = random(-200, -50);
                    this.color = `hsla(${random(180, 200)}, 100%, ${random(50, 70)}%, 0.7)`;
                    this.vy = random(5, 10);
                    this.size = random(1.5, 3);
                    this.length = random(36, 60);
                },
                
                draw: function() {
                    ctx.fillStyle = this.color;
                    ctx.shadowBlur = 22;
                    ctx.shadowColor = this.color;
                    
                    const gradient = ctx.createLinearGradient(
                        this.x, this.y,
                        this.x, this.y + this.length
                    );
                    gradient.addColorStop(0, this.color.replace('0.7)', '0.9)'));
                    gradient.addColorStop(0.7, this.color.replace('0.7)', '0.5)'));
                    gradient.addColorStop(1, this.color.replace('0.7)', '0.2)'));
                    
                    ctx.beginPath();
                    ctx.moveTo(this.x, this.y);
                    ctx.lineTo(this.x, this.y + this.length);
                    ctx.lineWidth = this.size;
                    ctx.strokeStyle = gradient;
                    ctx.lineCap = 'round';
                    ctx.stroke();
                    
                    ctx.beginPath();
                    ctx.arc(this.x, this.y + this.length, this.size * 1.1, 0, Math.PI * 2);
                    ctx.fillStyle = gradient;
                    ctx.fill();
                    
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size/1.3, 0, Math.PI * 2);
                    ctx.fillStyle = this.color.replace('0.7)', '0.5)');
                    ctx.fill();
                    
                    ctx.shadowBlur = 0;
                    this.update();
                },
                
                update: function() {
                    this.y += this.vy;
                    
                    if (this.y > h + 50) {
                        this.init();
                        this.y = random(-200, -50);
                        this.length = random(36, 60);
                    }
                }
            };

            function resize() {
                w = canvas.width = window.innerWidth;
                h = canvas.height = window.innerHeight;
                
                drops.length = 0;
                setup();
            }

            function setup() {
                for (let i = 0; i < max; i++) {
                    const drop = new Raindrop();
                    drop.init();
                    drop.y = random(-h, h);
                    drops.push(drop);
                }
            }

            function animate() {
                ctx.fillStyle = 'rgba(10, 10, 18, 0.07)';
                ctx.fillRect(0, 0, w, h);
                
                for (let i = 0; i < drops.length; i++) {
                    drops[i].draw();
                }
                
                requestAnimationFrame(animate);
            }

            window.addEventListener('resize', resize);
            setup();
            animate();
        }
        
        // ===========================================
        // 7. АДАПТАЦИЯ ДЛЯ МОБИЛЬНЫХ УСТРОЙСТВ
        // ===========================================
        function handleMobileResize() {
            if (window.innerWidth < 768) {
                document.querySelectorAll('.timeline-btn').forEach(btn => {
                    btn.style.transform = 'none';
                });
                
                const openCommentsBtn = document.getElementById('openCommentsBtn');
                if (openCommentsBtn) {
                    openCommentsBtn.style.display = 'inline-flex';
                }
            } else {
                const openCommentsBtn = document.getElementById('openCommentsBtn');
                if (openCommentsBtn) {
                    openCommentsBtn.style.display = 'none';
                }
            }
        }
        
        window.addEventListener('resize', handleMobileResize);
        handleMobileResize();
        
        // ===========================================
        // 8. ФИНАЛЬНАЯ ПРОВЕРКА
        // ===========================================
        console.log('Все системы работают!');
        console.log('Доступные функции:');
        console.log('- Firebase авторизация: вход/регистрация/профиль/выход');
        console.log('- Firebase комментарии: добавление/просмотр/удаление');
        console.log('- Научные достижения: клик по карточкам');
        console.log('- Временная линия: клик по событиям');
        console.log('- Плеер серий: переключение между эпизодами');
        console.log('- Галерея: наведение для эффектов');
        
        // Эффект фейерверка при успешном входе
        function createFirework(x, y) {
            const firework = document.createElement('div');
            firework.className = 'firework';
            firework.style.left = x + 'px';
            firework.style.top = y + 'px';
            firework.style.width = '4px';
            firework.style.height = '4px';
            firework.style.background = 'radial-gradient(circle, var(--primary), var(--primary-light))';
            firework.style.boxShadow = '0 0 10px var(--primary)';
            document.body.appendChild(firework);
            
            const duration = 1000;
            const start = Date.now();
            
            function animate() {
                const elapsed = Date.now() - start;
                const progress = Math.min(elapsed / duration, 1);
                
                const scale = 1 + progress * 20;
                const opacity = 1 - progress;
                
                firework.style.transform = `scale(${scale})`;
                firework.style.opacity = opacity;
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    firework.remove();
                }
            }
            
            for (let i = 0; i < 12; i++) {
                createParticle(x, y);
            }
            
            animate();
        }
        
        function createParticle(x, y) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.style.left = x + 'px';
            particle.style.top = y + 'px';
            particle.style.width = '3px';
            particle.style.height = '3px';
            particle.style.background = 'radial-gradient(circle, var(--lab-blue), var(--timeline-blue))';
            particle.style.boxShadow = '0 0 5px var(--lab-blue)';
            document.body.appendChild(particle);
            
            const angle = Math.random() * Math.PI * 2;
            const speed = 2 + Math.random() * 3;
            const vx = Math.cos(angle) * speed;
            const vy = Math.sin(angle) * speed;
            
            const duration = 800 + Math.random() * 400;
            const start = Date.now();
            
            function animateParticle() {
                const elapsed = Date.now() - start;
                const progress = Math.min(elapsed / duration, 1);
                
                const currentX = x + vx * elapsed * 0.1;
                const currentY = y + vy * elapsed * 0.1;
                
                particle.style.left = currentX + 'px';
                particle.style.top = currentY + 'px';
                particle.style.opacity = 1 - progress;
                
                if (progress < 1) {
                    requestAnimationFrame(animateParticle);
                } else {
                    particle.remove();
                }
            }
            
            animateParticle();
        }
        
        // Добавляем фейерверк при успешном входе
        const originalCheckAuthState = firebaseAuthManager.checkAuthState;
        firebaseAuthManager.checkAuthState = function() {
            const result = originalCheckAuthState.call(this);
            
            this.authFunctions.onAuthStateChanged(this.auth, (user) => {
                if (user) {
                    // Запускаем фейерверки
                    setTimeout(() => {
                        for (let i = 0; i < 8; i++) {
                            const x = Math.random() * window.innerWidth;
                            const y = Math.random() * window.innerHeight;
                            setTimeout(() => createFirework(x, y), i * 100);
                        }
                    }, 500);
                }
            });
            
            return result;
        };
    });
</script>
</body>
</html>
